// Generated by CoffeeScript 1.6.3
(function() {
  var _ref,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  window.PGLinesChart = (function(_super) {
    __extends(PGLinesChart, _super);

    function PGLinesChart() {
      _ref = PGLinesChart.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    PGLinesChart.prototype.lines = null;

    PGLinesChart.prototype.mode = 'cardinal';

    PGLinesChart.prototype.modes = ['linear', 'linear-closed', 'step-before', 'step-after', 'basis', 'basis-open', 'basis-close', 'bundle', 'cardinal', 'cardinal-open', 'cardinal-closed', 'monotone'];

    PGLinesChart.prototype.createModeButtons = function() {
      var that;
      this.modes.forEach(function(mode) {
        return $('#modes').append("<button class='mode btn btn-info' data='" + mode + "'>" + mode + "</button>");
      });
      that = this;
      return $('button.mode').click(function() {
        that.mode = $(this).attr('data');
        return that.renderLines();
      });
    };

    PGLinesChart.prototype.createLines = function() {
      return this.lines = this.chart.append('g').attr('id', 'lines').attr('clip-path', 'url(#chart-area)');
    };

    PGLinesChart.prototype.initChart = function() {
      PGLinesChart.__super__.initChart.apply(this, arguments);
      this.createModeButtons();
      this.createLines();
      return this.renderLines();
    };

    PGLinesChart.prototype.renderLines = function() {
      var line, lines, that,
        _this = this;
      that = this;
      line = d3.svg.line().interpolate(this.mode).x(function(d) {
        return _this.scale.x(d[0]);
      }).y(function(d) {
        return _this.scale.y(d[1]);
      });
      lines = this.lines.selectAll('path.line').data([this.currDataset]);
      lines.enter().append("path").attr("class", "line").on('mouseover', function() {
        var m;
        $('.circle').remove();
        m = d3.mouse(this);
        return that.drawCircle(m[0], m[1]);
      });
      lines.exit().remove();
      return lines.transition().duration(1000).attr("d", function(d) {
        return line(d);
      });
    };

    PGLinesChart.prototype.updateChart = function(dataset, axes) {
      PGLinesChart.__super__.updateChart.call(this, dataset, axes);
      return this.renderLines();
    };

    PGLinesChart.prototype.drawCircle = function(x, y) {
      var _this = this;
      return this.chart.append("circle").attr("class", "circle").attr("cx", x).attr("cy", y).attr("r", 5).attr('fill', '#882244').on('click', function(d) {
        return _this.newPointDialog(x, y);
      }).append('title').text(function(d) {
        return "" + _this.axes.x + ": " + (_this.scale.x.invert(x)) + "\n" + _this.axes.y + ": " + (_this.scale.y.invert(y));
      });
    };

    PGLinesChart.prototype.newPointDialog = function(x, y) {
      var point, pointDialog;
      point = new PGChartPoint({
        id: 1
      });
      console.log(point);
      pointDialog = new PGChartPointView({
        model: point,
        id: "pointDialog" + (point.get('id'))
      });
      return $(this.container).append(pointDialog.render().$el);
    };

    return PGLinesChart;

  })(PGChart);

}).call(this);
