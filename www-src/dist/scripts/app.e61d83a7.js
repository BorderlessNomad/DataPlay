(function(){"use strict";angular.module("dataplayApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ipCookie","angularDc","nvd3"]),angular.module("dataplayApp").constant("config",{sessionHeader:"X-API-SESSION",sessionName:"DPSession",userId:"DPUId",userName:"DPUser",userType:"DPType",api:{base_url:"http://localhost:3000/api"}})}).call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(a){this.bubbleChartPostSetup=b(this.bubbleChartPostSetup,this),this.pieChartPostSetup=b(this.pieChartPostSetup,this),this.columnChartPostSetup=b(this.columnChartPostSetup,this),this.rowChartPostSetup=b(this.rowChartPostSetup,this),this.lineChartPostSetup=b(this.lineChartPostSetup,this),this.setPreview=b(this.setPreview,this),this.humanDate=b(this.humanDate,this),this.chartsRelated=a}return a.prototype.preview=!1,a.prototype.allowed=["line","bar","row","column","pie","bubble"],a.prototype.count=3,a.prototype.loading={related:!1},a.prototype.offset={related:0},a.prototype.limit={related:!1},a.prototype.max={related:0},a.prototype.chartsRelated=[],a.prototype.xTicks=6,a.prototype.width=275,a.prototype.height=200,a.prototype.margin={top:10,right:10,bottom:30,left:70},a.prototype.marginPreview={top:25,right:25,bottom:25,left:25},a.prototype.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a.prototype.humanDate=function(a){return a.getDate()+" "+this.monthNames[a.getMonth()]+", "+a.getFullYear()},a.prototype.findById=function(a){var b;return b=_.where(this.chartsRelated,{id:a}),null!=(null!=b?b[0]:void 0)?b[0]:null},a.prototype.setPreview=function(a){return null==a&&(a=!1),this.preview=a},a.prototype.setCustomMargin=function(a){return null==a&&(a={top:0,right:0,bottom:0,left:0}),this.customMargin=a},a.prototype.setLabels=function(a){return"pie"!==a.type?a.labels={x:a.xLabel,y:a.yyLabel||a.yLabel}:void 0},a.prototype.isPlotAllowed=function(a){return c.call(this.allowed,a)>=0?!0:!1},a.prototype.hasRelatedCharts=function(){return Object.keys(this.chartsRelated).length},a.prototype.getXScale=function(a){var b;return b=function(){var b;switch(null!=(b=a.patterns[a.xLabel].valuePattern)?b.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,this.width]);case"date":case"year":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.key})).range([0,this.width]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.key)})).range([0,this.width])}}.call(this)},a.prototype.getXUnits=function(a){var b;return b=function(){var b;switch(null!=(b=a.patterns[a.xLabel].valuePattern)?b.toLowerCase():void 0){case"date":case"year":return d3.time.years;case"intnumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()},a.prototype.getYScale=function(a){var b;return b=function(){var b;switch(null!=(b=a.patterns[a.yLabel].valuePattern)?b.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,this.height]);case"date":case"year":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.value})).range([0,this.height]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.value)})).range([0,this.height]).nice()}}.call(this)},a.prototype.lineChartPostSetup=function(a){var b,d,e,f,g,h;for(e=this.findById(a.anchorName()),e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),a.dimension(e.dimension),a.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],c.call(e.ordinals,d)<0&&e.ordinals.push(d.key);a.colorAccessor(function(a){return parseInt(a.y)%e.ordinals.length}),this.preview?(a.xAxis().ticks(0).tickFormat(function(){return""}),"function"==typeof a.yAxis&&"function"==typeof(b=a.yAxis()).ticks&&b.ticks(0).tickFormat(function(){return""}),a.margins(this.marginPreview)):a.xAxis().ticks(this.xTicks),null!=this.customMargin&&a.margins(this.customMargin),a.xAxisLabel(!1,0),a.yAxisLabel(!1,0),a.x(this.getXScale(e))},a.prototype.rowChartPostSetup=function(a){var b,d,e,f,g,h;for(d=this.findById(a.anchorName()),d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){return a.x}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],g=d.group.all(),e=0,f=g.length;f>e;e++)b=g[e],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key);a.colorAccessor(function(a,b){return b+1}),this.preview?(a.xAxis().ticks(0).tickFormat(function(){return""}),a.yAxis().ticks(0).tickFormat(function(){return""}),a.margins(this.marginPreview)):a.xAxis().ticks(this.xTicks),null!=this.customMargin&&a.margins(this.customMargin),a.x(this.getYScale(d)),(null!=(h=d.ordinals)?h.length:void 0)>0&&a.xUnits(this.getXUnits(d))},a.prototype.columnChartPostSetup=function(a){var b,d,e,f,g,h,i,j,k,l;for(f=this.findById(a.anchorName()),f.entry=crossfilter(f.values),f.dimension=f.entry.dimension(function(a){return a.x}),f.group=f.dimension.group().reduceSum(function(a){return a.y}),a.dimension(f.dimension),a.group(f.group),f.ordinals=[],j=f.group.all(),g=0,h=j.length;h>g;g++)e=j[g],c.call(f.ordinals,e)<0&&f.ordinals.push(e.key);a.colorAccessor(function(a,b){return b+1}),this.preview?(a.xAxis().ticks(0).tickFormat(function(){return""}),a.yAxis().ticks(0).tickFormat(function(){return""}),a.margins(this.marginPreview)):a.xAxis().ticks(this.xTicks),null!=this.customMargin&&a.margins(this.customMargin),a.x(this.getXScale(f)),(null!=(k=f.ordinals)?k.length:void 0)>0&&a.xUnits(this.getXUnits(f)),i=a.margins(),b=2,l=b*(f.ordinals.length+1),d=(this.width-i.right-i.left-l)/f.ordinals.length,a.renderlet(function(a){var c;return c=d-2*b,1>c&&(c=3),a.selectAll("g.chart-body rect").attr("width",c).attr("x",function(a,c){return c*d+2*b})})},a.prototype.pieChartPostSetup=function(a){var b;b=this.findById(a.anchorName()),b.entry=crossfilter(b.values),b.dimension=b.entry.dimension(function(a){return function(c){var d;return"date"===b.patterns[b.xLabel].valuePattern?a.humanDate(c.x):d=null!=c.x&&(c.x.length>0||"date"===b.patterns[b.xLabel].valuePattern)?c.x:"N/A"}}(this)),b.groupSum=0,b.group=b.dimension.group().reduceSum(function(a){var c;return c=Math.abs(parseFloat(a.y)),b.groupSum+=c,c}),a.innerRadius(Math.min(this.width,this.height)/4),a.dimension(b.dimension),a.group(b.group),a.colorAccessor(function(a,b){return b+1}),a.renderLabel(!1)},a.prototype.bubbleChartPostSetup=function(a){var b,d,e,f,g,h,i,j,k,l,m,n;for(d=this.findById(a.anchorName()),i=null,g=null,k=function(a){return"number"!=typeof a?k(parseFloat(a)):0===a||isNaN(a)||"number"!=typeof a?0:0>a?k(-1*a):1>a?k(100*a):a},d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){return a.z=k(a.z),(null==i||i>a.z)&&(i=0===a.z?1:a.z),(null==g||g<=a.z)&&(g=0===a.z?1:a.z),a.x+"|"+a.y+"|"+a.z}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],m=d.group.all(),e=0,f=m.length;f>e;e++)b=m[e],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key.split("|")[0]);a.keyAccessor(function(a){return a.key.split("|")[0]}),a.valueAccessor(function(a){return a.key.split("|")[1]}),a.radiusValueAccessor(function(a){var b;return b=Math.abs(parseInt(a.key.split("|")[2])),b>=i?b:i}),a.x(function(){var a;switch(null!=(a=d.patterns[d.xLabel].valuePattern)?a.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(d.ordinals).rangeBands([0,this.width]);case"date":case"year":return d3.time.scale().domain(d3.extent(d.group.all(),function(a){return a.key.split("|")[0]})).range([0,this.width]);default:return d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return parseInt(a.key.split("|")[0])})).range([0,this.width])}}.call(this)),a.y(function(){var a;switch(null!=(a=d.patterns[d.xLabel].valuePattern)?a.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(d.ordinals).rangeBands([0,this.height]);case"date":case"year":return d3.time.scale().domain(d3.extent(d.group.all(),function(a){return a.key.split("|")[1]})).range([0,this.height]);default:return d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return parseInt(a.key.split("|")[1])})).range([0,this.height])}}.call(this)),l=d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return Math.abs(parseInt(a.key.split("|")[2]))})),a.r(l),this.preview?(a.xAxis().ticks(0).tickFormat(function(){return""}),a.yAxis().ticks(0).tickFormat(function(){return""}),a.margins(this.marginPreview)):a.xAxis().ticks(this.xTicks),null!=this.customMargin&&a.margins(this.customMargin),a.title(function(a){var b,c,e;return b=a.key.split("|")[0],c=a.key.split("|")[1],e=a.key.split("|")[2],d.xLabel+": "+b+"\n"+d.yLabel+": "+c+"\n"+d.zLabel+": "+e}),j=Math.log(i),h=Math.log(g),n=Math.abs(Math.log((h-j)/(g-i))),a.maxBubbleRelativeSize(n/100)},a}(),window.RelatedCharts=a}.call(this),function(){"use strict";var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};c={margin:{top:15,bottom:45,right:75,left:75},marginPreview:{top:0,bottom:0,right:0,left:0},xTicks:8},e={bar:"column",area:"line"},d=function(a){return function(b){return"string"==typeof a&&(a=a.toLowerCase()),"none"===a?"":"date"===a?d3.time.format("%d-%m-%Y")(new Date(b)):"year"===a?d3.time.format("%Y")(new Date(b)):d3.format(",f")(b)}},b={line:{chart:{type:"multiChart",height:450,margin:_.cloneDeep(c.margin),x:function(a,b){return b},y:function(a){return a[1]},color:d3.scale.category10().range(),transitionDuration:0,xAxis:{axisLabel:"",showMaxMin:!0,tickFormat:d(),ticks:c.xTicks},yAxis1:{orient:"left",axisLabel:"",axisLabelDistance:20,tickFormat:d(),showMaxMin:!1,highlightZero:!1},yAxis2:{orient:"right",axisLabel:"",axisLabelDistance:60,tickFormat:d(),showMaxMin:!1,highlightZero:!1},yDomain1:[0,1e3],yDomain2:[0,1e3]}},column:{chart:{type:"multiChart",height:450,margin:_.cloneDeep(c.margin),x:function(a,b){return b},y:function(a){return a[1]},color:d3.scale.category10().range(),transitionDuration:0,xAxis:{axisLabel:"",showMaxMin:!0,tickFormat:d(),ticks:c.xTicks},yAxis1:{orient:"left",axisLabel:"",axisLabelDistance:20,tickFormat:d(),showMaxMin:!1,highlightZero:!1},yAxis2:{orient:"right",axisLabel:"",axisLabelDistance:60,tickFormat:d(),showMaxMin:!1,highlightZero:!1},bars1:{groupSpacing:.5},bars2:{groupSpacing:.5},yDomain1:[0,1e3],yDomain2:[0,1e3]}},scatter:{chart:{type:"scatterChart",height:450,margin:_.cloneDeep(c.margin),color:d3.scale.category10().range(),scatter:{onlyCircles:!0},transitionDuration:0,xAxis:{axisLabel:"",showMaxMin:!0,tickFormat:d(),ticks:c.xTicks},yAxis:{axisLabel:"",axisLabelDistance:20,showMaxMin:!1,tickFormat:d(),highlightZero:!1},yAxis1:{},yAxis2:{},yDomain1:[0,1e3],yDomain2:[0,1e3]}}},a=function(){function a(a,b){null==b&&(b=[]),this.translateData=f(this.translateData,this),this.setLabels=f(this.setLabels,this),this.setTooltips=f(this.setTooltips,this),this.setLegend=f(this.setLegend,this),this.setMargin=f(this.setMargin,this),this.setSize=f(this.setSize,this),this.setPreview=f(this.setPreview,this),this.setAxisTypes=f(this.setAxisTypes,this),this.generate=f(this.generate,this),null!=a&&this.generate(a,b)}return a.prototype.preview=!1,a.prototype.type="",a.prototype.options={},a.prototype.data=[],a.prototype.error=null,a.prototype.info={},a.prototype.generate=function(a,c){return null==c&&(c=[]),null!=a&&null!=e[a]&&(a=e[a]),null!=a&&null!=b[a]?(this.type=a,this.options=_.cloneDeep(b[a]),this.data=c):this.error="Type not supported"},a.prototype.setAxisTypes=function(a,b,c){var e,f;return e={xAxis:a,yAxis1:b,yAxis2:c},null!=(null!=(f=this.options)?f.chart:void 0)?Object.keys(e).forEach(function(a){return function(b){return e[b]?a.options.chart[b].tickFormat=d(e[b]):void 0}}(this)):void 0},a.prototype.setPreview=function(a){var b,d,e;return null==a&&(a=!1),this.preview=a,b=null!=a?c.marginPreview:c.margin,null!=(null!=(d=this.options)&&null!=(e=d.chart)?e.margin:void 0)&&("undefined"!=typeof top&&null!==top&&(this.options.chart.margin.top=b.top),"undefined"!=typeof bottom&&null!==bottom&&(this.options.chart.margin.bottom=b.bottom),"undefined"!=typeof left&&null!==left&&(this.options.chart.margin.left=b.left),"undefined"!=typeof right&&null!==right)?this.options.chart.margin.right=b.right:void 0},a.prototype.setSize=function(a,b){var c;return null!=(null!=(c=this.options)?c.chart:void 0)&&(null!=a&&(this.options.chart.width=a),null!=b)?this.options.chart.height=b:void 0},a.prototype.setMargin=function(a,b,c,d){var e,f;return null!=(null!=(e=this.options)&&null!=(f=e.chart)?f.margin:void 0)&&(null!=a&&(this.options.chart.margin.top=a),null!=b&&(this.options.chart.margin.bottom=b),null!=c&&(this.options.chart.margin.left=c),null!=d)?this.options.chart.margin.right=d:void 0},a.prototype.setLegend=function(a){var b;return null!=(null!=(b=this.options)?b.chart:void 0)&&null!=a&&"boolean"==typeof a?this.options.chart.showLegend=a:void 0},a.prototype.setTooltips=function(a){var b;return null!=(null!=(b=this.options)?b.chart:void 0)&&null!=a&&"boolean"==typeof a?this.options.chart.tooltips=a:void 0},a.prototype.setLabels=function(a){return"pie"!==a.type&&(this.labels={x:a.table1.xLabel,y1:a.table1.yLabel,y2:a.table2.yLabel}),this.labels.x&&this.options.chart.xAxis&&(this.options.chart.xAxis.axisLabel=this.labels.x),this.labels.y1&&(this.options.chart.yAxis?this.options.chart.yAxis.axisLabel=this.labels.y1:this.options.chart.yAxis1&&(this.options.chart.yAxis1.axisLabel=this.labels.y1)),this.labels.y2&&this.options.chart.yAxis2?this.options.chart.yAxis2.axisLabel=this.labels.y2:void 0},a.prototype.translateData=function(a,b){var c;return c=function(a){if("string"==typeof a){if(!isNaN(Date.parse(a)))return Date.parse(a);if(!isNaN(parseFloat(a)))return parseFloat(a)}return a},a.map(function(a){var d;return d={x:c(a.x||0),y:parseFloat(a.y||0)},"scatter"===b&&(d.size=3,d.shape="circle"),d})},a}(),window.CorrelatedChart=a}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(c,d){null==c&&(c=""),null==d&&(d=[]),this.getColor=b(this.getColor,this),this.appendRegion=b(this.appendRegion,this),this.generate=b(this.generate,this),this.selector=c,this.data=d,$.getJSON("../regions.json",function(b){return a.prototype.boundaryPaths=b})}return a.prototype.selector="",a.prototype.data=[],a.prototype.width=180,a.prototype.height=148,a.prototype.maxvalue=50,a.prototype.generate=function(a){var b,c,d;return a?this.data=a:a=this.data,b=d3.select(this.selector),c=b.append("svg").attr("width",this.width).attr("height",this.height),d=c.append("g").attr("transform","translate("+this.width/2+", "+this.height/2+")"),a.forEach(function(a){return function(b){return b.slug=b.name.toLowerCase().replace(/_|\-|\'|\s/g,""),a.appendRegion(d,b)}}(this))},a.prototype.appendRegion=function(a,b){return a.append("g").attr("class","region").attr("id","region-"+b.slug).attr("data-display",b.name).append("path").attr("fill",this.getColor(b)).attr("stroke","#000000").attr("stroke-width","1").attr("stroke-opacity","0.05").attr("d",this.boundaryPaths[b.name]).append("title").html(b.name+": "+b.value)},a.prototype.getColor=function(a,b){var c,d,e,f;return f="object"==typeof a?a.value||0:a||0,f/=b||this.maxvalue,0===f?"#FFE455":(e={r:255,g:228,b:85},c={r:186,g:63,b:60},d={},Object.keys(e).forEach(function(a){return d[a]=Math.round(e[a]+(c[a]-e[a])*f)}),"#"+d.r.toString(16)+d.g.toString(16)+d.b.toString(16))},a.prototype.boundaryPaths={},a}(),window.MapGenerator=a}.call(this),function(){"use strict";angular.module("dataplayApp").directive("match",[function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(a,b,c,d){a.$watch(function(){return d.$pristine&&angular.isUndefined(d.$modelValue)||a.match===d.$modelValue},function(a){d.$setValidity("match",a)})}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").filter("truncate",[function(){return function(a,b,c,d){var e;return null==b&&(b=10),null==c&&(c=!1),null==d&&(d=" ..."),null==a?"":a.length<=b?a:(a=a.substr(0,b),c&&(e=a.lastIndexOf(" "),-1!==e&&(a=a.substr(0,e))),""+a+d)}}])}.call(this),function(){"use strict";angular.module("dataplayApp").filter("orderObjectBy",[function(){return function(a,b,c){var d;return d=[],angular.forEach(a,function(a){d.push(a)}),d.sort(function(a,c){return a[b]>c[b]?1:-1}),c&&d.reverse(),d}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Auth",["ipCookie","config",function(a,b){return{get:function(b){var c;return c=a(b),null!=c?c:!1},set:function(b,c){return a(b,c,{expires:31536e3,expirationUnit:"seconds"})},remove:function(b){return a.remove(b)},isAuthenticated:function(){var c;return c=a(b.sessionName),null!=c&&c.length?!0:!1},isAdmin:function(){var c;return c=a(b.userType),null!=c?!!c:!1}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("User",["$http","Auth","config",function(a){return{logIn:function(b,c){var d;return d={password:c},/^\S+@\S+\.\S+$/.test(b)?d.email=b:d.username=b,a.post("login",d)},logOut:function(){return a["delete"]("logout")},register:function(b,c,d){return a.post("register",{username:b,email:c,password:d})},socialLogin:function(b){return a.post("login/social",{network:b.network||"",id:b.id||"",email:b.email||"",full_name:b.full_name||"",first_name:b.first_name||"",last_name:b.last_name||"",image:b.image||""})},check:function(b){return a.post("user/check",{email:b})},forgotPassword:function(b){return a.post("user/forgot",{email:b})},token:function(b,c,d){return null!=d?a.put("user/reset/"+b,{email:c,password:d}):a.get("user/reset/"+b+"/"+c)},resetPassword:function(b,c){return a.post("user/reset",{hash:b,password:c})},visited:function(){return a.get("visited")},search:function(b,c,d){var e;return b=b.replace(/\/|\\/g," "),e="/search/"+b,null!=c&&(e+="/"+c,null!=d&&(e+="/"+d)),a.get(e)},searchTweets:function(b){return a.get("tweets/"+b)},getNews:function(b){return b instanceof Array&&(b=b.join("_")),b=b.replace(/\s{1,}|\%20|\/|\\/g,"_"),a.get("news/search/"+b)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Overview",["$http","config",function(a){var b,c,d;return d=d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!==a.getDate()}],["%b %d",function(a){return 1!==a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]),b={},c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],{charts:function(a,c){return null==a?(b={},null):(null!=c&&(b[a]=c),null!=b[a]?b[a]:null)},humanDate:function(a){return a.getDate()+" "+c[a.getMonth()]+", "+a.getFullYear()},getRandomInteger:function(a,b){return Math.floor(Math.random()*(b-a)+a)},info:function(b){return a.get("chartinfo/"+b)},related:function(b,c,d){return c=null!=c?c:0,d=null!=d?d:3,a.get("related/"+b+"/"+c+"/"+d)},correlated:function(b,c,d,e){return c=null!=c?c:0,d=null!=d?d:3,e=null!=e?e:100,a.get("correlated/"+b+"/true/"+c+"/"+d)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Charts",["$http","config",function(a){return{related:function(b,c,d,e,f,g){var h;return h="/chart/"+b+"/"+c+"/"+d+"/"+e+"/"+f,null!=g&&(h+="/"+g),a.get(h)},correlated:function(b){return a.get("chartcorrelated/"+b)},bookmark:function(b){return a.post("setbookmark",{data:b})},creditChart:function(b,c,d){var e;return e="/chart/",e+="rid"===b?c.replace(/\//g,"_"):c,e+="/"+d,a.put(e)},getObservations:function(b){return a.get("observations/"+b)},createObservation:function(b,c,d,e){return a.put("observations",{did:""+b,x:""+c,y:""+d,comment:e})},creditObservation:function(b,c){return a.put("observations/"+b+"/"+c)},flagObservation:function(b){return a.post("observations/flag/"+b)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").config(["$httpProvider",function(a){return a.interceptors.push("RequestInterceptor")}]).factory("RequestInterceptor",["$q","Auth","config",function(a,b,c){return{request:function(d){return d.headers[c.sessionHeader]=b.get(c.sessionName),"views/"!==d.url.substring(0,6)&&(d.url=c.api.base_url+"/"+d.url),d||a.when(d)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("PatternMatcher",function(){var a,b,c,d;return a=[{name:"creditCard",handlers:[{pattern:/^(4\d{3}[-]*\d{4}[-]*\d{4}[-]*\d(?:\d{3})?)|(5[1-5]\d{2}[-]*\d{4}[-]*\d{4}[-]*\d{4})|(6(?:011|5[0-9]{2})[-]*\d{4}[-]*\d{4}[-]*\d{4})|(3[47]\d{2}[-]*\d{6}[-]*\d{5})|(3(?:0[0-5]|[68][0-9])\d[-]*\d{6}[-]*\d{4})|((?:2131|1800)[-]*\d{6}[-]*\d{5}|35\d{2}[-]*\d{4}[-]*\d{4}[-]*\d{4})$/i}]},{name:"url",handlers:[{pattern:/^(#Scheme[a-z][a-z0-9+\-.]*:(#Authority&path\/\/([a-z0-9\-._~%!$&'()*+,;=]+@)?([a-z0-9\-._~%]+|\[[a-f0-9:.]+\]|\[v[a-f0-9][a-z0-9\-._~%!$&'()*+,;=:]+\])(:[0-9]+)?(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?|#Pathwithoutauthority(\/?[a-z0-9\-._~%!$&'()*+,;=:@]+(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?)?)|#RelativeURL(noschemeorauthority)([a-z0-9\-._~%!$&'()*+,;=@]+(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?|(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)+\/?))(\?[a-z0-9\-._~%!$&'()*+,;=:@\/?]*)?(\#[a-z0-9\-._~%!$&'()*+,;=:@\/?]*)?$/i}]},{name:"email",handlers:[{pattern:/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i}]},{name:"domain",handlers:[{pattern:/^\b((?=[a-z0-9-]{1,63}\.)(xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,63}\b$/i}]},{name:"ipv4",handlers:[{pattern:/\b(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b/i}]},{name:"nin",handlers:[{pattern:/\b[abceghj-prstw-z][abceghj-nprstw-z] ?\d{2} ?\d{2} ?\d{2} ?[a-dfm]?\b/i}]},{name:"postCode",handlers:[{pattern:/\b[A-Z]{1,2}[0-9][A-Z0-9]? [0-9][ABD-HJLNP-UW-Z]{2}\b/i}]},{name:"vat",handlers:[{pattern:/^(GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})$/i}]},{name:"currency",handlers:[{pattern:/^[+-]?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{2})?|(?:,[0-9]{3})*(?:\.[0-9]{2})?|(?:\.[0-9]{3})*(?:,[0-9]{2})?)£€\$$/i}]},{name:"date",handlers:[{pattern:/^[^0-9]*(((0|1|2)?\d\d\d)-)?((0)?([1-9])|1[012])-((0)?([1-9])|[12][0-9]|3[01])[^0-9]*$/,parse:function(){return function(a){return c(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9])}}(this)}]},{name:"intNumber",handlers:[{pattern:/^[-+]?\d+$/i,parse:function(){return function(a){return parseInt(a)}}(this)}]},{name:"floatNumber",handlers:[{pattern:/^[-+]?\b[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?\b$/i,parse:function(){return function(a){return parseFloat(a)}}(this)}]},{name:"percent",handlers:[{pattern:/^\b[0-9]+(\.[0-9]+)?%\b$/i,parse:function(){return function(a){return parseFloat(a)}}(this)}]},{name:"label",handlers:[{pattern:/^[a-zA-Z]{1}.{0,63}$/i}]},{name:"text",handlers:[{pattern:/^.*$/i}]}],b=[{name:"identifier",pattern:/id|account|ref|((credit\b)?card)|(post\bcode)/i},{name:"date",pattern:/date|year|day/i},{name:"coefficient",pattern:/^coef|ind|ratio|percent|count$/i},{name:"mapLongitude",pattern:/^(lon|ln|lng|long|longitud|longitude)$/i},{name:"mapLatitude",pattern:/^(lat|lt|ltt|latit|latitud|latitude)$/i}],d=function(a){var b;return b=function(){switch(a){case"Jan":case"January":case"jan":case"january":return"01";case"Feb":case"February":case"feb":case"february":return"02";case"Mar":case"March":case"mar":case"march":return"03";case"Apr":case"April":case"apr":case"april":return"04";case"May":case"may":return"05";case"Jun":case"June":case"jun":case"june":return"06";case"Jul":case"July":case"jul":case"july":return"07";case"Aug":case"August":case"aug":case"august":return"08";case"Sep":case"September":case"sep":case"september":return"09";case"Oct":case"October":case"oct":case"october":return"10";case"Nov":case"November":case"nov":case"november":return"11";case"Dec":case"December":case"dec":case"december":return"12";default:return null}}()},c=function(a,b,c,d,e,f,g){return new Date(b,d-1,g)},{getPattern:function(b){var c,d,e,f,g;for(g=null,d=function(a){var c,d,e,f,h;if(!g){for(f=a.handlers,h=[],d=0,e=f.length;e>d;d++)c=f[d],h.push(function(c){var d;return!g&&(d=c.pattern.exec(b))?g=a.name:void 0}(c));return h}},e=0,f=a.length;f>e;e++)c=a[e],d(c);return g},getKeyPattern:function(a){var c,d,e,f,g;for(g=null,c=function(b){var c;return!g&&(c=b.pattern.exec(a))?g=b.name:void 0},d=0,f=b.length;f>d;d++)e=b[d],c(e);return g},parse:function(b,c){var d,e,f,g;for(g=null,e=0,f=a.length;f>e;e++)d=a[e],d.name===c&&!function(a){var c,d,e,f,h;for(f=a.handlers,h=[],d=0,e=f.length;e>d;d++)c=f[d],h.push(function(a){var c;return!g&&(c=a.pattern.exec(b))?g=a.parse?a.parse(c):b:void 0}(c));return h}(d);return g},includePattern:function(a,b){var c;return c=function(){switch(a){case"excluded":return!1;case"label":case"date":case"postCode":case"creditCard":case"currency":return!0;case"intNumber":case"floatNumber":switch(b){case"date":case"coefficient":return!0;case null:return!0;default:return!1}break;default:return!1}}()}}})}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Profile",["$http","Auth","config",function(a){return{getInfo:function(b){return a.get((null!=b?b.length:void 0)>0?"profile/"+b:"user")},setInfo:function(b,c){return a.put("user",{email:b,username:c})},getCreditDiscoveries:function(b){return a.get((null!=b?b.length:void 0)>0?"profile/"+b+"/credited":"profile/credited")},getDiscoveries:function(b){return a.get((null!=b?b.length:void 0)>0?"profile/"+b+"/discoveries":"profile/discoveries")},getObservations:function(b){return a.get((null!=b?b.length:void 0)>0?"profile/"+b+"/observations":"profile/observations")}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("ActivityMonitor",["$http","Auth","config",function(a){return{get:function(b){return null==b&&(b="d"),a.get("political/"+b)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Home",["$http","Auth","config",function(a){return{getStats:function(){return a.get("home/data")},getTopRated:function(){return a.get("chart/toprated")},getAwaitingCredit:function(){return a.get("chart/awaitingcredit")},getActivityStream:function(){return a.get("user/activitystream")},getRecentObservations:function(){return a.get("recentobservations")},getDataExperts:function(){return a.get("user/experts")}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Admin",["$http","Auth","config",function(a){return{getUsers:function(b,c,d){var e;return null==b&&(b="uid"),null==c&&(c=0),null==d&&(d=15),e=["uid","email","reputation","avatar","username","usertype","enabled"],-1===e.indexOf(b)&&(b="uid"),a.get("admin/user/get/"+b+"/"+c+"/"+d)},editUser:function(b){return a.put("admin/user/edit",b)},getObservations:function(b,c,d,e){var f;return null==b&&(b="observation_id"),null==c&&(c=0),null==d&&(d=15),null==e&&(e=!1),f=["comment","discovered_id","uid","rating","credited","discredited","observation_id","created","x","y","flagged"],-1===f.indexOf(b)&&(b="observation_id"),a.get("admin/observations/get/"+b+"/"+c+"/"+d+"/"+e)},deleteObservation:function(b){return a["delete"]("admin/observations/"+b)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").config(["$routeProvider","$locationProvider","$provide",function(a,b,c){c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}]),a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",title:["Home"],login:!0}).when("/",{templateUrl:"views/landing.html",controller:"LandingCtrl",login:!1}).when("/about",{templateUrl:"views/about.html",controller:"LandingCtrl",title:["About"],login:!1}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl",title:["Search"],login:!0,preventReload:!0}).when("/search/:query",{templateUrl:"views/search.html",controller:"SearchCtrl",title:["Search"],login:!0,preventReload:!0}).when("/activitymonitor",{templateUrl:"views/activitymonitor.html",controller:"ActivityMonitorCtrl",title:["Activity Monitor"],login:!0}).when("/overview/:id",{templateUrl:"views/overview.html",controller:"OverviewCtrl",title:["Overview"],login:!0}).when("/overview/:id/:offset/:count",{templateUrl:"views/overview.html",controller:"OverviewCtrl",title:["Overview"],login:!0}).when("/charts/related/:id/:key/:type/:x/:y",{templateUrl:"views/charts.html",controller:"ChartsRelatedCtrl",title:["Chart","Related"],login:!0}).when("/charts/related/:id/:key/:type/:x/:y/:z",{templateUrl:"views/charts.html",controller:"ChartsRelatedCtrl",title:["Chart","Related"],login:!0}).when("/charts/correlated/:correlationid",{templateUrl:"views/charts.html",controller:"ChartsCorrelatedCtrl",title:["Chart","Correlated"],login:!0}).when("/map/:id",{templateUrl:"views/map.html",controller:"MapCtrl",title:["Map"],login:!0}).when("/user/login",{templateUrl:"views/user/login.html",title:["Login/Register"],login:!1}).when("/user/logout",{templateUrl:"views/user/login.html",controller:"UserCtrl",title:["Logout"],login:!0}).when("/user/forgotpassword",{templateUrl:"views/user/forgot-password.html",controller:"UserCtrl",title:["Forgot Password"],login:!1}).when("/user/resetpassword/:token",{templateUrl:"views/user/reset-password.html",controller:"UserCtrl",title:["Reset Password"],login:!1}).when("/user",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",title:["Profile"],login:!0}).when("/user/:tab",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",title:["Profile"],login:!0}).when("/profile",{redirectTo:"/user"}).when("/profile/:user",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",title:["Profile"],login:!0}).when("/profile/:user/:tab",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",title:["Profile"],login:!0}).when("/admin",{templateUrl:"views/admin/dashboard.html",controller:"AdminUsersCtrl",title:["Admin"],login:!0}).when("/admin/users",{templateUrl:"views/admin/users.html",controller:"AdminUsersCtrl",title:["Admin - Users"],login:!0}).when("/admin/observations",{templateUrl:"views/admin/observations.html",controller:"AdminObservationsCtrl",title:["Admin - Observations"],login:!0}).otherwise({redirectTo:"/"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("dataplayApp").run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){null!=d&&d.login&&!c.isAuthenticated()&&(b.search("return",b.path()),b.path("/user/login"))}),a.$on("$routeChangeSuccess",function(b,c){var d,e,f,g,h,i,j;if(c.hasOwnProperty("$$route")&&(null!=(g=c.$$route.title)?g.length:void 0)>0){for(i="",h=c.$$route.title,e=d=0,f=h.length;f>d;e=++d)j=h[e],i+=" - "+j;a.title=i}})}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("RecentCtrl",["$scope","$location","User","Auth","Overview","config",function(a,b,c,d,e,f){a.Auth=d,a.username=d.get(f.userName),a.config=f,a.lastVisited=[],a.isActive=function(a){return b.path().substr(0,a.length)===a},a.getLastVisited=function(){return e.charts(null),d.isAuthenticated()?void c.visited().success(function(b){a.lastVisited=b}).error(function(a){console.log("Home::Visited::Error:",a)}):void(a.lastVisited=[])}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("SearchCtrl",["$scope","$location","$routeParams","User","Overview","PatternMatcher","ActivityMonitor",function(a,b,c,d,e,f,g){a.query=null!=c.query?c.query:"",a.results=[],a.total=null,a.tweets=[],a.rowLimit=3,a.overview=[],a.isSearch=!!a.query,a.chartsRelated=[],a.suggestions=[],a.relatedChart=new RelatedCharts(a.chartsRelated),a.relatedChart.setPreview(!0),a.relatedChart.width=250,
a.relatedChart.height=190,a.init=function(b){return null==b&&(b=!1),b&&(a.chartsRelated=[],a.relatedChart.chartsRelated=a.chartsRelated,a.tweets=[],a.overview=[]),a.loading.related=a.query.length>0,a.loading.tweets=a.query.length>0,a.loading.overview=a.query.length>0,a.isSearch?(a.search(),a.getTweets(),a.getNews()):a.getSuggestions()},a.changePage=function(){var c,d;return d=a.query.replace(/\/|\\/g," "),c="/search/"+d,b.path()!==c?b.path(c):a.init(!0)},a.search=function(b,c){null==b&&(b=0),null==c&&(c=6),a.query.length<3||(a.loading.related=!0,d.search(a.query,b,c).success(function(b){a.loading.related=!1,a.results=b.Results,a.total=b.Total,a.results.forEach(function(b){return b.graph=[],b.error=null,a.getRelated(b)})}).error(function(b){a.loading.related=!1,console.log("Search::search::Error:",b)}))},a.getTweets=function(){a.query.length<3||(a.loading.tweets=!0,d.searchTweets(a.query).success(function(b){return a.loading.tweets=!1,null!=b&&b instanceof Array?(a.tweets.splice(0),b.forEach(function(b){return a.query.split(/\s{1,}|\_{1,}/).forEach(function(a){return b.comment=b.comment.replace(new RegExp("("+a+")","gi"),'<span class="highlight">$1</span>')}),b.comment=b.comment.replace(/(<\/span>)(\s{1,}|\-{1,})(<span class="highlight">)/gi,"$2"),b.url="https://twitter.com/"+b.username+"/status/"+b.id,a.tweets.push(b)})):void 0}).error(function(){return a.loading.tweets=!1}))},a.getNews=function(){return a.query.length<3?void 0:(a.loading.overview=!0,d.getNews(a.query).success(function(b){return a.loading.overview=!1,b instanceof Array?a.overview=b.map(function(a){return{date:e.humanDate(new Date(a.date)),title:a.title,url:a.url,thumbnail:a.image_url}}):void 0}).error(function(b){a.loading.overview=!1,console.log("Search::getNews::Error:",b)}))},a.getSuggestions=function(){return a.loading.suggestions=!0,a.suggestions=[],g.get("popular").success(function(b){var c;return a.loading.suggestions=!1,null!=b&&(c=_.find(b,{id:"most_popular"}),null!=c&&c.top instanceof Array&&(a.suggestions=c.top,a.suggestions.length>8))?a.suggestions=a.suggestions.slice(0,8):void 0}).error(function(b){a.loading.suggestions=!1,console.log("Search::getSuggestions::Error:",b)})},a.showMore=function(){return a.search(a.chartsRelated.length)},a.collapse=function(a){return a.show=!1},a.uncollapse=function(a){return a.show=!0},a.getRelated=function(b,c){var d;null==c&&(c=0),d={loading:!0,title:b.Title,guid:b.GUID},a.chartsRelated.push(d),b.loading=!0,e.related(b.GUID,c,1).success(function(c){var e,g,h,i,j,k,l;if(null!=c&&null!=c.charts&&c.charts.length>0){j=c.charts;for(h in j)if(e=j[h],a.relatedChart.isPlotAllowed(e.type)){if(h=parseInt(h),e.guid=b.GUID,e.key=h,e.id="related-"+e.guid+"-"+(e.key+a.offset.related)+"-"+e.type,e.url="charts/related/"+e.guid+"/"+e.key+"/"+e.type+"/"+e.xLabel+"/"+e.yLabel,"bubble"===e.type&&(e.url+="/"+e.zLabel),e.patterns={},e.patterns[e.xLabel]={valuePattern:f.getPattern(e.values[0].x),keyPattern:f.getKeyPattern(e.values[0].x)},"date"===e.patterns[e.xLabel].valuePattern)for(k=e.values,h=g=0,i=k.length;i>g;h=++g)l=k[h],e.values[h].x=new Date(l.x);null!=e.yLabel&&(e.patterns[e.yLabel]={valuePattern:f.getPattern(e.values[0].y),keyPattern:f.getKeyPattern(e.values[0].y)}),a.relatedChart.setLabels(e),d.loading=!1,delete e.title,_.merge(d,e)}}}).error(function(b,c){a.loading.related=!1,console.log("Overview::getRelated::Error:",c)})},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.loading=a.relatedChart.loading,a.offset=a.relatedChart.offset,a.limit=a.relatedChart.limit,a.max=a.relatedChart.max,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("OverviewCtrl",["$scope","$routeParams","$location","Overview",function(a,b,c,d){return a.params=b,a.info={name:a.params.id,title:a.params.id},a.hasInfo=!1,a.error=null,a.info=function(){return d.info(a.params.id).success(function(b){a.info=b,a.info.name!==a.params.id?c.path("/overview/"+a.info.name).replace():a.hasInfo=!0,console.log(a.info)}).error(a.handleError)},a.handleError=function(b,c){return console.log("Overview::info::Error:",c),a.error=function(){switch(!1){case!(b&&b.message):return b.message;case!(b&&b.data&&b.data.message):return b.data.message;case!(b&&b.data):return b.data;case!b:return b;default:return""}}(),"<html>"===a.error.substring(0,6)?a.error=function(){var b;return b=a.error,b=b.replace(/(\r\n|\n|\r)/gm,""),b=b.replace(/.{0,}(\<title\>)/,""),b=b.replace(/(\<\/title\>).{0,}/,"")}():void 0}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("OverviewRelatedCtrl",["$scope","$routeParams","Overview","PatternMatcher",function(b,c,d,e){b.allowed=["line","bar","row","column","pie","bubble"],b.params=c,b.count=3,b.loading={related:!1},b.offset={related:0},b.limit={related:!1},b.max={related:0},b.chartsRelated=[],b.xTicks=6,b.width=350,b.height=200,b.margin={top:0,right:0,bottom:0,left:0},b.relatedChart=new RelatedCharts(b.chartsRelated),b.relatedChart.setPreview(!0),b.relatedChart.setCustomMargin(b.margin),b.findById=function(a){var c;return c=_.where(b.chartsRelated,{id:a}),null!=(null!=c?c[0]:void 0)?c[0]:null},b.isPlotAllowed=function(c){return a.call(b.allowed,c)>=0?!0:!1},b.getRelatedCharts=function(){b.getRelated(d.charts("related"))},b.hasRelatedCharts=function(){return Object.keys(b.chartsRelated).length},b.getRelated=function(a){b.loading.related=!0,null==a&&(a=b.max.related-b.offset.related,a=b.max.related&&a<b.count?a:b.count),d.related(b.params.id,b.offset.related,a).success(function(c){var f,g,h,i,j,k,l;if(b.loading.related=!1,null!=c&&null!=c.charts&&c.charts.length>0){b.max.related=c.count,j=c.charts;for(h in j)if(f=j[h],b.relatedChart.isPlotAllowed(f.type)){if(h=parseInt(h),f.key=h,f.id="related-"+b.params.id+"-"+(f.key+b.offset.related)+"-"+f.type,f.url="charts/related/"+b.params.id+"/"+f.key+"/"+f.type+"/"+f.xLabel+"/"+f.yLabel,"bubble"===f.type&&(f.url+="/"+f.zLabel),f.patterns={},f.patterns[f.xLabel]={valuePattern:e.getPattern(f.values[0].x),keyPattern:e.getKeyPattern(f.values[0].x)},"date"===f.patterns[f.xLabel].valuePattern)for(k=f.values,h=g=0,i=k.length;i>g;h=++g)l=k[h],f.values[h].x=new Date(l.x);null!=f.yLabel&&(f.patterns[f.yLabel]={valuePattern:e.getPattern(f.values[0].y),keyPattern:e.getKeyPattern(f.values[0].y)}),b.relatedChart.setLabels(f),b.chartsRelated.push(f)}b.offset.related+=a,b.offset.related>=b.max.related&&(b.limit.related=!0),d.charts("related",b.offset.related)}}).error(function(a,c){b.loading.related=!1,console.log("Overview::getRelated::Error:",c)})},b.resetAll=function(){return dc.filterAll(),dc.redrawAll()},b.width=b.relatedChart.width,b.height=b.relatedChart.height,b.margin=b.relatedChart.margin,b.hasRelatedCharts=b.relatedChart.hasRelatedCharts,b.lineChartPostSetup=b.relatedChart.lineChartPostSetup,b.rowChartPostSetup=b.relatedChart.rowChartPostSetup,b.columnChartPostSetup=b.relatedChart.columnChartPostSetup,b.pieChartPostSetup=b.relatedChart.pieChartPostSetup,b.bubbleChartPostSetup=b.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("OverviewCorrelatedCtrl",["$scope","$routeParams","Overview","PatternMatcher",function(b,c,d){b.allowed=["line","bar","row","column","bubble","scatter","stacked"],b.params=c,b.count=3,b.loading={correlated:!1},b.offset={correlated:0},b.limit={correlated:!1},b.max={correlated:0},b.chartsCorrelated=[],b.xTicks=6,b.width=350,b.height=200,b.margin={top:10,right:10,bottom:30,left:70},b.findById=function(a){var c;return c=_.where(b.chartsCorrelated,{id:a}),null!=(null!=c?c[0]:void 0)?c[0]:null},b.isPlotAllowed=function(c){return a.call(b.allowed,c)>=0?!0:!1},b.getCorrelatedCharts=function(){b.getCorrelated(d.charts("correlated"))},b.hasCorrelatedCharts=function(){return Object.keys(b.chartsCorrelated).length},b.getCorrelated=function(a){var c;b.loading.correlated=!0,null==a||0===a?(a=b.max.correlated-b.offset.correlated,a=b.max.correlated&&a<b.count?a:b.count):c=!0,c=c||b.max.correlated?!1:!0,d.correlated(b.params.id,b.offset.correlated,a,!1).success(function(c){var e,f,g,h;if(b.loading.correlated=!1,null!=c&&null!=c.charts&&c.charts.length>0){b.max.correlated=c.count,h=c.charts;for(g in h)e=h[g],b.isPlotAllowed(e.type)&&(f=new CorrelatedChart(e.type),f.title=e.table2.title,f.coeff=Math.floor(Math.abs(100*e.coefficient)),f.strength=function(){return e.strength.split(" ").map(function(a){return a.substr(0,1).toUpperCase()+a.substr(1).toLowerCase()}).join(" ")}(),f.error||(g=parseInt(g),f.info={key:g,id:"correlated-"+b.params.id+"-"+(e.key+b.offset.correlated)+"-"+e.type,url:"charts/correlated/"+e.correlationid},[1,2].forEach(function(a){var b,c,d;return d=f.translateData(e["table"+a].values,e.type),b=function(){var a;return a=d3.min(d,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(d,function(a){return parseFloat(a.y)})]}(),c="column"===e.type||"bar"===e.type?"bar":"area",f.data.push({key:e["table"+a].title,type:c,yAxis:a,values:d}),f.options.chart["yDomain"+a]=b,f.options.chart["yAxis"+a].tickValues=[0],f.options.chart.xAxis.tickValues=[]}),f.setAxisTypes("none","none","none"),f.setSize(null,200),f.setMargin(25,25,25,25),f.setLegend(!1),f.setTooltips(!1),f.setPreview(!0),f.setLabels(e),b.chartsCorrelated.push(f)));console.log(b.chartsCorrelated),b.offset.correlated+=a,b.offset.correlated>=b.max.correlated&&(b.limit.correlated=!0),d.charts("correlated",b.offset.correlated)}}).error(function(a,c){b.loading.correlated=!1,console.log("Overview::getCorrelated::Error:",c)})},b.resetAll=function(){return dc.filterAll(),dc.redrawAll()}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("ChartsRelatedCtrl",["$scope","$location","$timeout","$routeParams","Auth","config","Overview","PatternMatcher","Charts",function(b,c,d,e,f,g,h,i,j){b.username=f.get(g.userName),b.userid=f.get(g.userId),b.params=e,b.mode="related",b.width=570,b.height=9*b.width/16,b.heightColumn=b.height+150,b.margin={top:50,right:20,bottom:50,left:50},b.marginColumn={top:50,right:20,bottom:150,left:50},b.marginAlt={top:0,right:10,bottom:50,left:60},b.xTicks=8,b.approveMsg=null,b.chartRendered=null,b.chart={title:"",description:"N/A",data:null,values:[]},b.xScale=null,b.yDomain=null,b.userObservations=null,b.userObservationsMessage=[],b.observation={x:null,y:null,message:""},b.info={discoveredId:null,approved:!1,disapproved:!1,patternId:null,discoverer:"",discoverDate:"",approvers:[],disapprovers:[],source:{prim:null,seco:null},strength:""},b.init=function(){b.initChart()},b.initChart=function(){j.related(b.params.id,b.params.key,b.params.type,b.params.x,b.params.y,b.params.z).success(function(a){var c;return null!=a&&a.chartdata&&(b.chart=a.chartdata,null!=a.desc&&a.desc.length>0&&(c=a.desc.replace(/(h1>|h2>|h3>)/gi,"h4>"),c=c.replace(/\n/gi,""),b.chart.description=c),b.reduceData()),null!=a&&(b.info.patternId=a.patternid||"",b.info.discoveredId=a.discoveredid||"",b.info.discoverer=a.discoveredby||"",b.info.discoverDate=a.discoverydate?h.humanDate(new Date(a.discoverydate)):"",b.info.approvers=a.creditedby||"",b.info.disapprovers=a.discreditedby||"",b.info.strength=a.statstrength,b.info.approved=a.userhascredited,b.info.disapproved=a.userhasdiscredited,b.info.source={prim:null,seco:null},(null!=a.source1||null!=a.overview1)&&(b.info.source.prim={title:a.source1||"",id:a.overview1||b.params.id||""}),(null!=a.source2||null!=a.overview2)&&(b.info.source.seco={title:a.source2||"",id:a.overview2||""})),b.initObservations()}).error(function(a,c){return b.handleError(a,c),console.log("Charts::init::Error:",c)})},b.initObservations=function(a){j.getObservations(b.info.discoveredId).then(function(c){var d,e;return b.userObservations=[],null!=(e=c.data)&&"function"==typeof e.forEach&&e.forEach(function(a){var c,d,e,f;return c=a.x,f=a.y,"date"===b.chart.patterns[b.chart.xLabel].valuePattern&&(c instanceof Date||"string"!=typeof c||(d=new Date(c),"Invalid Date"!==d.toString()&&(c=d)),c=h.humanDate(c)),e=c.replace(/\W/g,"")+"-"+f.replace(/\W/g,""),b.userObservationsMessage[e]=a.comment,""===a.user.avatar&&(a.user.avatar="http://www.gravatar.com/avatar/"+a.user.email+"?d=identicon"),b.userObservations.push({xy:e,oid:a.observation_id,user:a.user,approvals:a.credits,disapprovals:a.discredits,approvalCount:parseInt(a.credits-a.discredits)||0,message:a.comment,date:h.humanDate(new Date(a.created)),coor:{x:a.x,y:a.y},flagged:!!a.flagged,action:a.action,highlight:!1})}),null!=a&&a&&b.redrawObservationIcons(),d=d3.select("g.stack-list > .observations.new"),b.renderObservationIcons(b.xScale,b.yDomain,b.chart,d)},b.handleError)},b.reduceData=function(){var a,c,d,e,f;if(b.chart.data=b.chart.values,b.chart.patterns={},b.chart.patterns[b.chart.xLabel]={valuePattern:i.getPattern(b.chart.values[0].x),keyPattern:i.getKeyPattern(b.chart.values[0].x)},"date"===b.chart.patterns[b.chart.xLabel].valuePattern)for(e=b.chart.values,a=c=0,d=e.length;d>c;a=++c)f=e[a],b.chart.values[a].x=new Date(f.x);return null!=b.chart.yLabel?b.chart.patterns[b.chart.yLabel]={valuePattern:i.getPattern(b.chart.values[0].y),keyPattern:i.getKeyPattern(b.chart.values[0].y)}:void 0},b.getXScale=function(a){var c;return c=function(){switch(a.patterns[a.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,b.width]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.key})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.key)})).range([0,b.width])}}()},b.getYScale=function(a){var c;return c=function(){switch(a.patterns[a.yLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([b.height,0]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.value})).range([b.height,0]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.value)})).range([b.height,0])}}()},b.nearestNeighbour=function(a,b,c){var d,e,f,g;return a=parseInt(a),e=b[a][c],f=null!=b[a+1]?b[a+1][c]:null,g=null!=b[a-1]?b[a-1][c]:null,d=e,e===f?d=f:e===g?d=g:null==f||Math.abs(e-f)>=Math.abs(e-g)?d=g:(null==g||Math.abs(e-f)<=Math.abs(e-g))&&(d=f),d},b.drawObservationIcon=function(a,c,e,f,g){var i,j,k,l,m,n,o;return"date"===c.patterns[c.xLabel].valuePattern&&(e instanceof Date||"string"!=typeof e||(n=new Date(e),"Invalid Date"!==n.toString()&&(e=n)),e=h.humanDate(e)),o=e.replace(/\W/g,"")+"-"+f.replace(/\W/g,""),l="clipImage-"+o,j=a.append("clipPath").attr("id",l).attr("class","icon-clip").append("circle").attr("class","icon-circ").attr("r",10).attr("cx",g[0]).attr("cy",g[1]),k=(null!=(m=b.userObservationsMessage[o])?m.length:void 0)>0?b.userObservationsMessage[o]:"",k=k.length>10?k.substr(0,10)+"...":k,i=a.append("image").attr("id","observationIcon-"+o).attr("class","icon-image").attr("xlink:href",$("#observation-image").data("image")).attr("style","stroke: none; fill: none; fill-opacity: 0.0; stroke-opacity: 0.0").attr("height","20px").attr("width","20px").attr("x",g[0]-10).attr("y",g[1]-10).attr("clip-path","url(#"+l+")").attr("data-placement","top").attr("data-html",!0).tooltip(b.chart.xLabel+": "+e+"<br/>"+b.chart.yLabel+": "+f+"<br/>comment: "+k),i.on("click",function(){var a;return d3.event.stopPropagation(),null!=b.userObservations&&b.userObservations.length?(a=_.find(b.userObservations,{xy:o}),a.highlight=!0,d(function(){return a.highlight=!1},2e3),b.$apply()):void 0})},b.redrawObservationIcons=function(){return d3.selectAll("g.observations > *").remove()},b.renderObservationIcons=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;if(null!==b.userObservations){for(l=b.userObservations,m=[],h=0,i=l.length;i>h;h++)if(j=l[h],0!==j.coor.x&&"0"!==j.coor.x||0!==j.coor.y&&"0"!==j.coor.y){o=j.coor.x,o instanceof Date||"string"!=typeof o||(p=new Date(o),"Invalid Date"!==p.toString()&&(o=p));for(g in c){if(n=c[g],n.y===j.coor.y){f=g;break}parseInt(n.y)>parseInt(j.coor.y)&&(f=g)}null!=c&&null!=c[f]&&null!=c[f].y&&(q=c[f].y,k=[a(o),c[f].cy],m.push(b.drawObservationIcon(e,d,o,q,k)))}return m}},b.lineChartPostSetup=function(c){var d,e,f,g,i,j,k,l,m;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group,e.title),e.ordinals=[],k=e.group.all(),g=0,i=k.length;i>g;g++)d=k[g],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.keyAccessor(function(a){return a.key}),c.valueAccessor(function(a){return a.value}),c.title(function(a){var c;return c=a.key,"date"===b.chart.patterns[b.chart.xLabel].valuePattern&&(c=h.humanDate(a.key)),b.chart.xLabel+": "+c+"\n"+b.chart.yLabel+": "+a.value}),l=b.getXScale(e),c.x(l),m=b.getYScale(e),e.ordinals.length>0&&c.xUnits(function(){var a;switch(null!=(a=e.patterns[e.xLabel].valuePattern)?a.toLowerCase():void 0){case"date":case"year":return d3.time.years;case"intnumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.yAxisLabel(e.yyLabel||e.yLabel),f=null,j=null,c.renderlet(function(a){var c,d,g,h,i,k,n,o,p,q,r,s,t,u,v,w,x,y;for(x=d3.select("svg"),v=d3.select("g.stack-list").node(),c=v.getBBox(),w=d3.select("g.stack-list"),null==f&&(f=w.append("g").attr("class","stack _"+(w.length+0)+" observations existing")),null==j&&(j=w.append("g").attr("class","stack _"+(w.length+1)+" observations new")),b.redrawObservationIcons(),g=a.svg().selectAll("circle.dot"),d=a.svg().selectAll("circle.dot > title"),y=[],t=g[0],o=r=0,p=t.length;p>r;o=++r)h=t[o],y[o]={cy:h.cy.animVal.value,y:null};for(u=d[0],o=s=0,q=u.length;q>s;o=++s)i=u[o],n=i.innerHTML.split("\n"),y[o].y=n[1].split(": ")[1];return y.sort(function(a,b){return a.cy-b.cy}),k=null,g.on("click",function(a){return k=a}),x.on("click",function(){var a,d,f,g,h,i,n,p,q,r,s;if(n=d3.mouse(v),!(n[0]<0||n[1]<0||n[0]>c.width||n[1]>c.height)){for(null!=k?(r=k.x,s=k.y,k=null):(r=l.invert(n[0]),s=m.invert(n[1])),i=e.group.all(),f=h=0,g=i.length;g>h;f=++h)if(q=i[f],"date"===e.patterns[e.xLabel].valuePattern){if(r.getTime()===q.key.getTime()){o=f;break}r.getTime()>q.key.getTime()&&(o=f)}else{if(r===q.key){o=f;break}r>q.key&&(o=f)}r=e.group.all()[o].key,b.nearestNeighbour(o,e.group.all(),"key");for(d in y){if(p=y[d],p.cy===n[1]){a=d;break}p.cy<=n[1]&&(a=d)}return s=y[a].y,b.nearestNeighbour(a,y,"y"),b.openAddObservationModal(r,s),b.drawObservationIcon(j,e,r,s,n)}}),b.xScale=l,b.yDomain=y,b.renderObservationIcons(l,y,e,j)}),b.chartRendered=c},b.rangeChartPostSetup=function(c){var d,e,f,g,h;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.x(b.getXScale(e)),e.ordinals.length>0&&c.xUnits(function(){var a;switch(null!=(a=e.patterns[e.xLabel].valuePattern)?a.toLowerCase():void 0){case"date":case"year":return d3.time.years;case"intnumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}())},b.rowChartPostSetup=function(c){var d,e,f,g,h;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a,b){return(b+1)%20}),c.xAxis().ticks(b.xTicks),c.x(b.getYScale(e)),null!=e.ordinals&&e.ordinals.length>0&&c.xUnits(function(){var a;switch(null!=(a=e.patterns[e.xLabel].valuePattern)?a.toLowerCase():void 0){case"date":case"year":return d3.time.years;case"intnumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.xAxisLabel(e.xLabel),c.yAxisLabel(e.yyLabel||e.yLabel)},b.columnChartPostSetup=function(c){var d,e,f,g,h,i,j,k;for(g=b.chart,g.entry=crossfilter(g.values),g.dimension=g.entry.dimension(function(a){return a.x}),g.group=g.dimension.group().reduceSum(function(a){return a.y}),c.dimension(g.dimension),c.group(g.group),g.ordinals=[],j=g.group.all(),h=0,i=j.length;i>h;h++)f=j[h],a.call(g.ordinals,f)<0&&g.ordinals.push(f.key);c.colorAccessor(function(a,b){return b+1}),d=2,k=d*(g.ordinals.length+1),e=(b.width-b.marginColumn.right-b.marginColumn.left-k)/g.ordinals.length,c.yAxis().ticks(b.xTicks),c.x(b.getXScale(g)),null!=g.ordinals&&g.ordinals.length>0&&c.xUnits(function(){var a;switch(null!=(a=g.patterns[g.xLabel].valuePattern)?a.toLowerCase():void 0){case"date":case"year":return d3.time.years;case"intnumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.xAxisLabel(g.xLabel),c.yAxisLabel(g.yyLabel||g.yLabel),c.renderlet(function(a){return a.selectAll("g.chart-body rect").attr("width",e-2*d).attr("x",function(a,b){return b*e+2*d}),a.selectAll("g.x g.tick").attr("transform",function(a,b){var c;return c=b*e+2*d+e/2,"translate("+c+",0)"}),a.selectAll("g.x text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.15em").attr("transform",function(){return"rotate(-65)"})})},b.pieChartPostSetup=function(a){var c;c=b.chart,c.entry=crossfilter(c.values),c.dimension=c.entry.dimension(function(a){var b;return"date"===c.patterns[c.xLabel].valuePattern?h.humanDate(a.x):b=null!=a.x&&(a.x.length>0||"date"===c.patterns[c.xLabel].valuePattern)?a.x:"N/A"}),c.groupSum=0,c.group=c.dimension.group().reduceSum(function(a){var b;return b=Math.abs(parseFloat(a.y)),c.groupSum+=b,b}),a.dimension(c.dimension),a.group(c.group),a.colorAccessor(function(a,b){return b+1}),a.renderLabel(!1),a.renderTitle(!0),a.title(function(a){var b;return b=a.value/c.groupSum*100,a.key+": "+a.value+" ["+b.toFixed(2)+"%]"}),a.legend(dc.legend().x(0).y(350)),a.minAngleForLabel(0),a.innerRadius(75)},b.bubbleChartPostSetup=function(c){var d,e,f,g,h,i,j,k,l,m,n,o;for(e=b.chart,j=null,h=null,l=function(a){return"number"!=typeof a?l(parseFloat(a)):0===a||isNaN(a)||"number"!=typeof a?0:0>a?l(-1*a):1>a?l(100*a):a},e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.z=l(a.z),(null==j||j>a.z)&&(j=a.z<1?1:a.z),(null==h||h<=a.z)&&(h=a.z<1?1:a.z),a.x+"|"+a.y+"|"+a.z}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],n=e.group.all(),f=0,g=n.length;g>f;f++)d=n[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key.split("|")[0]);c.keyAccessor(function(a){return a.key.split("|")[0]}),c.valueAccessor(function(a){return a.key.split("|")[1]}),c.radiusValueAccessor(function(a){var b;return b=Math.abs(a.key.split("|")[2]),b>=j?b:j}),c.x(function(){var a;switch(null!=(a=e.patterns[e.xLabel].valuePattern)?a.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.width]);case"date":case"year":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[0]})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[0])})).range([0,b.width])}}()),c.y(function(){var a;switch(null!=(a=e.patterns[e.xLabel].valuePattern)?a.toLowerCase():void 0){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.height]);case"date":case"year":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[1]})).range([0,b.height]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[1])})).range([0,b.height])}}()),m=d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return Math.abs(parseInt(a.key.split("|")[2]||1))})),c.r(m),c.xAxis().ticks(b.xTicks),c.label(function(a){var b;return b=a.key.split("|")[0]}),c.title(function(a){var b,c,d;return b=a.key.split("|")[0],c=a.key.split("|")[1],d=a.key.split("|")[2],e.xLabel+": "+b+"\n"+(e.yyLabel||e.yLabel)+": "+c+"\n"+e.zLabel+": "+d}),k=Math.log(j),i=Math.log(h),o=Math.abs(Math.log((i-k)/(h-j))),c.maxBubbleRelativeSize(o/100),c.zoomOutRestrict(!0),c.mouseZoomable(!0),c.xAxisLabel(e.xLabel),c.yAxisLabel(e.yyLabel||e.yLabel)},b.approveChart=function(a){var c,d;return c=b.params.id+"/"+b.params.key+"/"+b.params.type+"/"+b.params.x+"/"+b.params.y,(null!=(d=b.params.z)?d.length:void 0)>0&&(c+="/"+b.params.z),j.creditChart("rid",c,a).then(function(){var c,d,e;return b.showApproveMessage(a),b.info.approved=!!a,b.info.disapproved=!a,e=f.get(g.userName),d=a?"disapprovers":"approvers",c=a?"approvers":"disapprovers",-1!==b.info[d].indexOf(e)&&b.info[d].splice(b.info[d].indexOf(e),1),b.info[c].push(e)},b.handleError)},b.saveObservation=function(){j.createObservation(b.info.discoveredId,b.observation.x,b.observation.y,b.observation.message).then(function(){return b.observation.message="",b.addObservation(b.observation.x,b.observation.y,b.observation.message),$("#comment-modal").modal("hide")},b.handleError)},b.clearObservation=function(){var a,c,d,e;return b.observation.message="",a=b.observation.x,e=b.observation.y,0!==a&&"0"!==a||0!==e&&"0"!==e?(a instanceof Date||"string"!=typeof a?a instanceof Date&&(a=h.humanDate(a)):(c=new Date(a),"Invalid Date"!==c.toString()&&(a=h.humanDate(c))),d=a.replace(/\W/g,"")+"-"+e.replace(/\W/g,""),d3.select("#clipImage-"+d).remove(),d3.select("#observationIcon-"+d).remove(),void $("#comment-modal").modal("hide")):void $("#comment-modal").modal("hide")},b.approveObservation=function(a,c){return null!=a.oid?j.creditObservation(a.oid,c).success(function(b){return a.approvals=b.Credited,a.disapprovals=b.Discredited,a.approvalCount=parseInt(b.credits-b.discredits)||0,a.action=b.action,a.flagged=!!b.flagged}).error(b.handleError):void 0},b.openAddObservationModal=function(a,c){b.observation.x=a||0,b.observation.y=c||0,b.observation.message="",$("#comment-modal").modal("show"),$("#comment-modal-usercomment").focus()},b.addObservation=function(){return b.initObservations(!0)},b.resetObservations=function(){return d3.selectAll("g.observations.new > *").remove()},b.flagObservation=function(a){return j.flagObservation(a.oid).success(function(){return a.flagged=!0})},b.resetAll=function(){return dc.filterAll(),dc.redrawAll(),b.resetObservations()},b.showApproveMessage=function(a){b.approveMsg=a,d(function(){return b.approveMsg=null},3e3)},b.handleError=function(a){return b.error={message:function(){switch(!1){case!(a&&a.message):return a.message;case!(a&&a.data&&a.data.message):return a.data.message;case!(a&&a.data):return a.data;case!a:return a;default:return""}}()},"<html>"===b.error.message.substring(0,6)?b.error.message=function(){var a;return a=b.error.message,a=a.replace(/(\r\n|\n|\r)/gm,""),a=a.replace(/.{0,}(\<title\>)/,""),a=a.replace(/(\<\/title\>).{0,}/,"")}():void 0}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("ChartsCorrelatedCtrl",["$scope","$location","$timeout","$routeParams","Auth","config","Overview","PatternMatcher","Charts",function(a,b,c,d,e,f,g,h,i){a.username=e.get(f.userName),a.userid=e.get(f.userId),a.params=d,a.mode="correlated",a.width=570,a.height=9*a.width/16,a.chart=new CorrelatedChart,a.userObservations=null,a.userObservationsMessage=[],a.observation={x:null,y:null,message:""},a.info={discoveredId:null,approved:!1,disapproved:!1,patternId:null,discoverer:"",discoverDate:"",approvers:[],disapprovers:[],overview:null,source:{prim:null,seco:null},strength:""},a.init=function(){a.initChart()},a.initChart=function(){i.correlated(a.params.correlationid).success(function(b){return null!=b&&b.chartdata&&(a.chart.generate(b.chartdata.type),a.chart.error||([1,2].forEach(function(c){var d,e,f;return f=a.chart.translateData(b.chartdata["table"+c].values,b.chartdata.type),d=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===b.chartdata.type||"bar"===b.chartdata.type?"bar":"area",a.chart.data.push({key:function(){var a,d;return a=b.chartdata["table"+c].title,a.length<35?a:(d=a.substr(0,35).split(" "),d.slice(0,d.length-1).join(" ")+" ...")}(),type:e,yAxis:c,values:f}),a.chart.options.chart["yDomain"+c]=d,a.chart.options.chart["yAxis"+c].tickValues=function(){return[1,2,3,4,5,6,7,8].map(function(a){return d[0]+(d[1]-d[0])*(1/8)*a})}()}),a.chart.setAxisTypes(b.chartdata.table1.xLabel,b.chartdata.table1.yLabel,b.chartdata.table2.yLabel),a.chart.setLabels(b.chartdata),a.chart.title=b.chartdata.table1.title+" & "+b.chartdata.table2.title)),null!=b&&(a.info.patternId=b.patternid||"",a.info.discoveredId=b.discoveredid||"",a.info.discoverer=b.discoveredby||"",a.info.discoverDate=b.discoverydate?g.humanDate(new Date(b.discoverydate)):"",a.info.approvers=b.creditedby||"",a.info.disapprovers=b.discreditedby||"",a.info.strength=b.statstrength,a.info.approved=b.userhascredited,a.info.disapproved=b.userhasdiscredited,a.info.coeff=Math.floor(Math.abs(100*b.coefficient)),a.info.overview=b.overview1,a.info.source={prim:null,seco:null},(null!=b.source1||null!=b.overview1)&&(a.info.source.prim={title:b.source1||"",id:b.overview1||a.params.id||""}),(null!=b.source2||null!=b.overview2)&&(a.info.source.seco={title:b.source2||"",id:b.overview2||""})),a.initObservations(),console.log("Chart",a.chart)}).error(function(a,b){return console.log("Charts::init::Error:",b)})},a.initObservations=function(){i.getObservations(a.info.discoveredId).then(function(b){var c;return a.userObservations=[],null!=(c=b.data)&&"function"==typeof c.forEach?c.forEach(function(b){var c,d,e;return c="0",e="0",d=c.replace(/\W/g,"")+"-"+e.replace(/\W/g,""),a.userObservationsMessage[d]=b.comment,""===b.user.avatar&&(b.user.avatar="http://www.gravatar.com/avatar/"+b.user.email+"?d=identicon"),a.userObservations.push({xy:d,oid:b.observation_id,user:b.user,approvals:b.credits,disapprovals:b.discredits,approvalCount:parseInt(b.credits-b.discredits)||0,message:b.comment,date:g.humanDate(new Date(b.created)),coor:{x:b.x,y:b.y},flagged:!!b.flagged,action:b.action})}):void 0},a.handleError)},a.approveChart=function(b){return i.creditChart("cid",a.params.correlationid,b).then(function(){var c,d,g;return a.showApproveMessage(b),a.info.approved=!!b,a.info.disapproved=!b,g=e.get(f.userName),d=b?"disapprovers":"approvers",c=b?"approvers":"disapprovers",-1!==a.info[d].indexOf(g)&&a.info[d].splice(a.info[d].indexOf(g),1),a.info[c].push(g)},a.handleError)},a.saveObservation=function(){i.createObservation(a.info.discoveredId,a.observation.x,a.observation.y,a.observation.message).then(function(){return a.observation.message="",a.addObservation(a.observation.x,a.observation.y,a.observation.message),$("#comment-modal").modal("hide")},a.handleError)},a.clearObservation=function(){var b,c,d,e;return a.observation.message="",b=a.observation.x,e=a.observation.y,0!==b&&"0"!==b||0!==e&&"0"!==e?(b instanceof Date||"string"!=typeof b?b instanceof Date&&(b=g.humanDate(b)):(c=new Date(b),"Invalid Date"!==c.toString()&&(b=g.humanDate(c))),d=b.replace(/\W/g,"")+"-"+e.replace(/\W/g,""),d3.select("#clipImage-"+d).remove(),d3.select("#observationIcon-"+d).remove(),void $("#comment-modal").modal("hide")):void $("#comment-modal").modal("hide");

},a.approveObservation=function(b,c){return null!=b.oid?i.creditObservation(b.oid,c).success(function(a){return b.approvals=a.Credited,b.disapprovals=a.Discredited,b.approvalCount=parseInt(a.credits-a.discredits)||0,b.action=a.action,b.flagged=!!a.flagged}).error(a.handleError):void 0},a.openAddObservationModal=function(b,c){a.observation.x=b||0,a.observation.y=c||0,a.observation.message="",$("#comment-modal").modal("show"),$("#comment-modal-usercomment").focus()},a.addObservation=function(){return a.initObservations(!0)},a.resetObservations=function(){return a.observations=[]},a.flagObservation=function(a){return i.flagObservation(a.oid).success(function(){return a.flagged=!0})},a.resetAll=function(){return dc.filterAll(),dc.redrawAll(),a.resetObservations()},a.showApproveMessage=function(b){a.approveMsg=b,c(function(){return a.approveMsg=null},3e3)},a.handleError=function(b){return a.error={message:function(){switch(!1){case!(b&&b.message):return b.message;case!(b&&b.data&&b.data.message):return b.data.message;case!(b&&b.data):return b.data;case!b:return b;default:return""}}()},"<html>"===a.error.message.substring(0,6)?a.error.message=function(){var b;return b=a.error.message,b=b.replace(/(\r\n|\n|\r)/gm,""),b=b.replace(/.{0,}(\<title\>)/,""),b=b.replace(/(\<\/title\>).{0,}/,"")}():void 0}}])}.call(this),function(){"use strict";hello.init({facebook:"849402518433862",google:"233668141851-tjicormqo6m2ld7rdckk2ok2vnqf3ff3.apps.googleusercontent.com"},{redirect_uri:"redirect.html",scope:"email"}),angular.module("dataplayApp").controller("UserCtrl",["$scope","$location","$routeParams","User","Auth","config",function(a,b,c,d,e,f){a.params=c,a.user={type:null,login:{token:a.params.token,username:null,password:null,message:null},register:{token:a.params.token,username:null,email:null,password:null,password_confirm:null,message:null}},a.forgotPassword={valid:!1,sent:!1},a.resetPassword={valid:!1,saved:!1},a.currentTab="details",a.login=function(b){null!=b.username&&null!=b.password&&d.logIn(b.username,b.password).success(function(b){a.processLogin(b)}).error(function(b){a.user.type="login",a.user.login.message=b,console.log("User::Login::Error:",b)})},a.processLogin=function(a){var c;e.set(f.userName,a.user),e.set(f.userType,a.usertype),e.set(f.sessionName,a.session),b.search()["return"]?(c=b.search()["return"],b.search("return",null),b.path(c)):b.path("/home")},a.socialLogin=function(b){return hello(b).login().then(function(c){return hello(c.network).api("/me").then(function(c){var e,f;return e={network:b,id:c.id||"",email:c.email||"",full_name:c.name||"",first_name:c.first_name||"",last_name:c.last_name||""},"facebook"===b?e.image=c.picture||"":"google"===b&&(e.image=(null!=(f=c.image)?f.url:void 0)||""),d.socialLogin(e).success(function(b){return a.processLogin(b)}).error(function(b){a.user.type="socialLogin",a.user.login.message=b,console.log("User::SocialLogin::Error:",b)})},function(a){return console.log("Error on /me",a)})},function(a){return console.log("Error on login",a)})},a.logout=function(){var c;c=e.get(f.sessionName),c!==!1&&d.logOut(c).success(function(){e.remove(f.userName),e.remove(f.userType),e.remove(f.sessionName),b.path("/")}).error(function(b){a.user.type="logout",a.user.login.message=b,console.log("User::Logout::Error:",b)}),b.path("/user/login")},a.register=function(b){null!=b.username&&null!=b.email&&null!=b.password&&d.register(b.username,b.email,b.password).success(function(b){a.processLogin(b)}).error(function(b){a.user.type="register",a.user.register.message=b,console.log("User::Register::Error:",b)})},a.forgotPassword=function(b){a.closeAlert(),null!=b.username&&d.check(b.username).success(function(){return a.forgotPassword.valid=!0,d.forgotPassword(b.username).success(function(b){a.forgotPassword.sent=!0,a.user.login.token=b.token,a.user.register.token=b.token}).error(function(b,c){a.forgotPassword.valid=!1,a.user.type="forgotPassword",a.user.login.message=b,console.log("User::ForgotPassword::token::Error:",b,c)})}).error(function(b,c){a.user.type="forgotPassword",a.user.login.message=b,console.log("User::ForgotPassword::check::Error:",b,c)})},a.resetPasswordCheck=function(b){return a.closeAlert(),null!=b.token&&null!=b.username?d.token(b.token,b.username).success(function(){a.resetPassword.valid=!0}).error(function(b,c){a.user.type="resetPasswordCheck",a.user.login.message=b,console.log("User::ResetPassword::check::Error:",b,c)}):void 0},a.resetPassword=function(b){return a.closeAlert(),null!=b.token&&null!=b.username&&null!=b.password?d.token(b.token,b.username,b.password).success(function(){a.resetPassword.saved=!0}).error(function(b,c){a.user.type="resetPassword",a.user.login.message=b,console.log("User::ResetPassword::save::Error:",b,c)}):void 0},a.hasError=function(b){var c,d;return(null!=(c=a.user[b])&&null!=(d=c.message)?d.length:void 0)&&a.user.type===b},a.closeAlert=function(){return a.user.type=null,a.user.login.message=null,a.user.register.message=null},a.changeTab=function(b){return a.currentTab=b}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("ProfileCtrl",["$scope","$location","$routeParams","Profile","Auth","config",function(a,b,c,d,e,f){var g,h,i,j,k,l;a.params=c,a.currentTab=(null!=(i=a.params)&&null!=(j=i.tab)?j.length:void 0)>0?a.params.tab:"profile",a.currentTab="profile"===a.currentTab&&null!=(null!=(k=a.params)?k.user:void 0)?"approveddiscoveries":a.currentTab,a.error={message:null},a.loading={profile:!1,approveddiscoveries:!1,discoveries:!1,observations:!1},a.current={email:"",username:"",avatar:""},a.saved={email:"",username:"",success:!1},a.isLoggedInUser=/^(\/user)/.test(b.url()),a.isLoggedInUser||(a.current.username=c.user,g=e.get(f.userName),a.current.username===g&&b.path("/user/profile").replace()),a.approvedDiscoveries=[],a.discoveries=[],a.observations=[],a.truncate=40,a.profile=function(b){return null==b&&(b=""),a.loading.profile=!0,d.getInfo(b).success(function(c){a.loading.profile=!1,a.current.email=c.email,a.current.username=c.username,a.current.avatar=c.avatar||"http://www.gravatar.com/avatar/"+c.email_hash+"?d=identicon",null!=b&&b.length||(a.saved.email=c.email,a.saved.username=c.username)}).error(function(b,c){return a.loading.profile=!1,a.handleError(b,c)})},a.approveddiscoveries=function(b){return null==b&&(b=""),a.loading.approveddiscoveries=!0,a.profile(b),d.getCreditDiscoveries(b).success(function(b){a.loading.approveddiscoveries=!1,b instanceof Array&&(a.approvedDiscoveries=b)}).error(function(b,c){return a.loading.approveddiscoveries=!1,a.handleError(b,c)})},a.discoveries=function(b){return null==b&&(b=""),a.loading.discoveries=!0,a.profile(b),d.getDiscoveries(b).success(function(b){a.loading.discoveries=!1,b instanceof Array&&(a.discoveries=b)}).error(function(b,c){return a.loading.discoveries=!1,a.handleError(b,c)})},a.observations=function(b){return null==b&&(b=""),a.loading.observations=!0,a.profile(b),d.getObservations(b).success(function(b){a.loading.observations=!1,b instanceof Array&&(a.observations=b)}).error(function(b,c){return a.loading.observations=!1,a.handleError(b,c)})},"function"==typeof a[h=a.currentTab]&&a[h](null!=(l=a.params.user)?l:null),a.changeTab=function(a){return b.path("/user/"+a)},a.submitDetails=function(){return d.setInfo(a.current.email,a.current.username).then(function(){return a.saved.email=a.current.email,a.saved.username=a.current.username,a.saved.success=!0})},a.clearDetails=function(){return a.current.email=a.saved.email,a.current.username=a.saved.username},a.closeAlert=function(){return a.saved.success=!1},a.hasError=function(){var b;return(null!=(b=a.error.message)?b.length:void 0)?!0:!1},a.handleError=function(b){return a.error.message=function(){switch(!1){case!(b&&b.message):return b.message;case!(b&&b.data&&b.data.message):return b.data.message;case!(b&&b.data):return b.data;case!b:return b;default:return""}}(),"<html>"===a.error.message.substring(0,6)?a.error.message=function(){var b;return b=a.error.message,b=b.replace(/(\r\n|\n|\r)/gm,""),b=b.replace(/.{0,}(\<title\>)/,""),b=b.replace(/(\<\/title\>).{0,}/,"")}():void 0}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("ActivityMonitorCtrl",["$scope","$location","$routeParams","ActivityMonitor","Auth","config",function(b,c,d,e){b.params=d,b.mapGen=new MapGenerator("#regionMap"),b.margin={top:0,right:0,bottom:0,left:0},b.mainSections={keywords:{order:0,title:"Keywords",colNameA:"Keywords",colNameB:"Last 30 days",valDesc:"Number of appearances in data",error:null,type:"pie",graph:[],items:[]},mediapulse:{order:1,title:"Media Pulse",colNameA:"Keywords",colNameB:"Last 30 days",valDesc:"Number of appearances in media in last 30 days",error:null,type:"pie",graph:[],items:[]},regions:{order:2,title:"London Borough Activity",colNameA:"Location",colNameB:"Last 30 days",valDesc:"Number of appearances in media in last 30 days",error:null,type:"map",graph:[],items:[]}},b.colourMap={},b.sidebarSections=[],b.init=function(){return Object.keys(b.mainSections).forEach(function(a){return e.get(a).success(function(c){var d,e,f,g,h;return b.mainSections[a].error=!1,c instanceof Array&&(f=0,e=0,b.mainSections[a].items=c.filter(function(a){var b,c,d,g;for(a.val>e&&(e=a.val),g=a.graph,c=0,d=g.length;d>c;c++)b=g[c],b.y>f&&(f=b.y);return!!a.term}),b.mainSections[a].items.forEach(function(c){c.max=f,c.slug=c.term.toLowerCase().replace(/_|\-|\'|\s/g,""),c.id=a.replace(/\W/g,"").toLowerCase().substr(0,1)+"-"+c.slug,c.highlight=!1,b.mainSections[a].graph.push({id:c.id,slug:c.slug,term:c.term,value:c.val,max:f})}),"map"===b.mainSections[a].type)?(d={},b.mainSections[a].graph.forEach(function(a){return d[a.term]=a}),b.mapGen.maxvalue=e,g=Object.keys(b.mapGen.boundaryPaths).map(function(a){var b;return{name:a,value:(null!=(b=d[a])?b.value:void 0)||0}}),b.mapGen.generate(g),b.mainSections[a].items.forEach(function(a){var c;return a.corresponds="region-"+a.slug,a.color=b.mapGen.getColor((null!=(c=d[a.term])?c.value:void 0)||0)}),h=d3.selectAll(".region"),h.on("mouseover",function(){var c,d,e,f,g,h;return g=d3.event.pageX-$(window.document).scrollLeft(),h=d3.event.pageY-$(window.document).scrollTop(),c=d3.select(this),d=c.attr("id"),e=_.find(b.mainSections[a].items,{corresponds:d}),null!=e&&(e.highlight=!0),f=_.find(b.mainSections[a].graph,function(a){return a.id.replace("r-","")===c.attr("id").replace("region-","")}),null==f&&(f={id:c.attr("id").replace("region-","r-"),slug:c.attr("id").replace("region-",""),term:c.attr("data-display"),value:0}),d3.select("#pie-tooltip").style("left",g+"px").style("top",h+"px").attr("class","tooltip fade top in").select(".tooltip-inner").text(f.term+": "+f.value),b.$apply()}),h.on("mouseout",function(){var c,d,e;return c=d3.select(this),d=c.attr("id"),e=_.find(b.mainSections[a].items,{corresponds:d}),null!=e&&(e.highlight=!1),d3.select("#pie-tooltip").attr("class","tooltip top hidden"),b.$apply()})):void 0}).error(function(){return b.mainSections[a].error=!0,b.handleError(a)})}),e.get("popular").success(function(a){return a instanceof Array?b.sidebarSections=a.map(function(a){return a.url="top_discoverers"===a.id?"user/profile":"search",a.top=a.top.filter(function(a){return a.amount>0}),a}):void 0}).error(function(){return b.handleError("popular")})},b.renderLine=function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n;for(g=b.graph,f=crossfilter(g),e=f.dimension(function(a){return a.x}),h=e.group().reduceSum(function(a){return a.y}),k=[],l=h.all(),i=0,j=l.length;j>i;i++)d=l[i],a.call(k,d)<0&&k.push(d.key);c.colorAccessor(function(a){return parseInt(a.y)%k.length}),c.dimension(e),c.group(h),m=d3.scale.linear().domain(d3.extent(h.all(),function(a){return parseInt(a.key)})).range([0,60]),c.x(m),n=d3.scale.linear().domain([0,b.max]),c.y(n),c.keyAccessor(function(a){return a.key}),c.valueAccessor(function(a){return a.value}),c.xAxis().ticks(0).tickFormat(function(){return""}),c.yAxis().ticks(0).tickFormat(function(){return""}),c.xAxisLabel(!1,0),c.yAxisLabel(!1,0)}},b.renderPie=function(a){return function(c){var d,e,f,g,h,i,j;return h=a.graph,g=crossfilter(h),f={},e=g.dimension(function(a){return f[a.term+"-"+a.value]=a.id,a.term}),j=0,i=e.group().reduceSum(function(a){return j+=a.value,a.value}),c.dimension(e),c.group(i),d=function(){var b;return b={min:100,max:0},a.graph.forEach(function(a){return a.value>b.max&&(b.max=a.value),a.value<b.min?b.min=a.value:void 0}),b}(),c.colors(function(c){var e;return e=0,a.graph.forEach(function(a){return a.term===c?e=a.value:void 0}),b.mapGen.getColor(e-d.min,d.max-d.min)}),c.renderlet(function(c){var d,e;return e=d3.select("svg"),d=c.svg().selectAll("g.pie-slice"),d.each(function(a){var c,d,e;return d=f[a.data.key+"-"+a.data.value],e=d3.select(this),e.attr("id","slice-"+d),c=e.select("path").attr("fill"),b.colourMap[d]=c}),d.on("mouseover",function(c){var d,e,f,g,h,i;return g=d3.select(this),d=g.attr("id"),e=_.find(a.items,{id:d.replace("slice-","")}),null!=e&&(e.highlight=!0),h=d3.event.pageX-$(window.document).scrollLeft(),i=d3.event.pageY-$(window.document).scrollTop(),f=(c.data.value/j*100).toFixed(2),d3.select("#pie-tooltip").style("left",h+"px").style("top",i+"px").attr("class","tooltip fade top in").select(".tooltip-inner").text(c.data.key+": "+c.data.value+" ("+f+"%)"),b.$apply()}),d.on("mouseout",function(){var c,d,e;return e=d3.select(this),c=e.attr("id"),d=_.find(a.items,{id:c.replace("slice-","")}),null!=d&&(d.highlight=!1),d3.select("#pie-tooltip").attr("class","tooltip top hidden"),b.$apply()})})}},b.highlight=function(a,b,c){var d;return"pie"===b?d=d3.select("#slice-"+c.id+" path"):"map"===b&&(d=d3.select("#"+c.corresponds+" path")),null==d||d.empty()?void 0:d.attr("class",a?"highlight":null)},b.labelClass=function(a){return"label label-primary label-severe-"+(a+1)},b.handleError=function(a){return function(c){var d;return d=function(){switch(!1){case!(c&&c.message):return c.message;case!(c&&c.data&&c.data.message):return c.data.message;case!(c&&c.data):return c.data;case!c:return c;default:return""}}(),"popular"!==a&&(b.mainSections[a].error=d,"<html>"===b.mainSections[a].error.substring(0,6))?b.mainSections[a].error=function(){var c;return c=b.mainSections[a].error,c=c.replace(/(\r\n|\n|\r)/gm,""),c=c.replace(/.{0,}(\<title\>)/,""),c=c.replace(/(\<\/title\>).{0,}/,"")}():void 0}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("LandingCtrl",["$scope","$location","Home","Auth","Overview","PatternMatcher","config",function(a,b,c,d,e,f,g){a.config=g,a.Auth=d,a.username=d.get(g.userName),a.loading={charts:!0},a.chartsRelated=[],a.relatedChart=new RelatedCharts(a.chartsRelated),a.relatedChart.setPreview(!0),a.relatedChart.width=225,a.relatedChart.height=175,d.isAuthenticated()&&b.path("/home"),a.stats={players:null,discoveries:null,datasets:null},a.init=function(){return c.getStats().success(function(b){return b instanceof Array?b.forEach(function(b){return a.stats[b.Label]=a.commarise(b.Value)}):void 0}),a.loading.charts=!0,c.getTopRated().success(function(b){var c,d,e,g,h,i,j,k,l,m,n;if(a.loading.charts=!1,null!=b&&b.length>0){m=[];for(h in b)if(c=b[h],a.relatedChart.isPlotAllowed(c.type)&&4>h)if(h=parseInt(h),null!=c.relationid){if(e=c.relationid.split("/")[0],c.key=h,c.id="related-"+e+"-"+(c.key+a.relatedChart.offset.related)+"-"+c.type,c.url="charts/related/"+e+"/"+c.key+"/"+c.type+"/"+c.xLabel+"/"+c.yLabel,"bubble"===c.type&&(c.url+="/"+c.zLabel),c.patterns={},c.patterns[c.xLabel]={valuePattern:f.getPattern(c.values[0].x),keyPattern:f.getKeyPattern(c.values[0].x)},"date"===c.patterns[c.xLabel].valuePattern)for(j=c.values,h=g=0,i=j.length;i>g;h=++g)n=j[h],c.values[h].x=new Date(n.x);null!=c.yLabel&&(c.patterns[c.yLabel]={valuePattern:f.getPattern(c.values[0].y),keyPattern:f.getKeyPattern(c.values[0].y)}),a.relatedChart.setLabels(c),m.push(a.chartsRelated.push(c))}else null!=c.correlationid?(d=new CorrelatedChart(c.type),!d.error&&(null!=(k=a.params)&&null!=(l=k.id)?l.length:void 0)>0?(d.info={key:h,id:"correlated-"+a.params.id+"-"+(c.key+a.offset.correlated)+"-"+c.type,url:"charts/correlated/"+c.correlationid,title:[c.table1.title,c.table2.title]},[1,2].forEach(function(a){var b,e,f;return f=d.translateData(c["table"+a].values,c.type),b=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===c.type||"bar"===c.type?"bar":"area",d.data.push({key:c["table"+a].title,type:e,yAxis:a,values:f}),d.options.chart["yDomain"+a]=b,d.options.chart["yAxis"+a].tickValues=[0],d.options.chart.xAxis.tickValues=[]}),d.setAxisTypes("none","none","none"),d.setSize(null,200),d.setMargin(25,25,25,25),d.setLegend(!1),d.setTooltips(!1),d.setPreview(!0),d.setLabels(c),m.push(a.chartsRelated.push(d))):m.push(void 0)):m.push(void 0);return m}})},a.commarise=function(a){return Number(a).toLocaleString()},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";d3.selection.prototype.duration=function(){return this},angular.module("dataplayApp").controller("HomeCtrl",["$scope","$location","Home","Auth","Overview","PatternMatcher","config",function(a,b,c,d,e,f,g){a.config=g,a.Math=window.Math,a.searchquery="",a.approvePatterns=null,a.myActivity=null,a.recentObservations=null,a.dataExperts=null,a.loading={charts:!0},a.chartsRelated=[],a.relatedChart=new RelatedCharts(a.chartsRelated),a.relatedChart.setPreview(!0),a.relatedChart.width=225,a.relatedChart.height=175,a.init=function(){return a.loading.charts=!0,c.getAwaitingCredit().success(function(b){var c,d,e,g,h,i,j,k,l,m;if(a.loading.charts=!1,null!=b&&null!=b.charts&&b.charts.length>0){e=0,k=b.charts;for(i in k){if(c=k[i],4===e)break;if(a.relatedChart.isPlotAllowed(c.type))if(i=parseInt(i),null!=c.relationid){if(e++,g=c.relationid.split("/")[0],c.key=i,c.id="related-"+g+"-"+(c.key+a.relatedChart.offset.related)+"-"+c.type,c.url="charts/related/"+g+"/"+c.key+"/"+c.type+"/"+c.xLabel+"/"+c.yLabel,"bubble"===c.type&&(c.url+="/"+c.zLabel),c.patterns={},c.patterns[c.xLabel]={valuePattern:f.getPattern(c.values[0].x),keyPattern:f.getKeyPattern(c.values[0].x)},"date"===c.patterns[c.xLabel].valuePattern)for(l=c.values,i=h=0,j=l.length;j>h;i=++h)m=l[i],c.values[i].x=new Date(m.x);null!=c.yLabel&&(c.patterns[c.yLabel]={valuePattern:f.getPattern(c.values[0].y),keyPattern:f.getKeyPattern(c.values[0].y)}),a.relatedChart.setLabels(c),a.chartsRelated.push(c)}else null!=c.correlationid&&(d=new CorrelatedChart(c.type),d.error||(e++,d.info={key:i,id:"correlated-"+c.correlationid,url:"charts/correlated/"+c.correlationid,title:[c.table1.title,c.table2.title]},[1,2].forEach(function(a){var b,e,f;return f=d.translateData(c["table"+a].values,c.type),b=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===c.type||"bar"===c.type?"bar":"area",d.data.push({key:c["table"+a].title,type:e,yAxis:a,values:f}),d.options.chart["yDomain"+a]=b,d.options.chart["yAxis"+a].tickValues=[0],d.options.chart.xAxis.tickValues=[]}),d.setAxisTypes("none","none","none"),d.setSize(null,200),d.setMargin(25,25,25,25),d.setLegend(!1),d.setTooltips(!1),d.setPreview(!0),d.setLabels(c),a.chartsRelated.push(d)))}return console.log(a.chartsRelated)}return a.approvePatterns=[]}).error(function(){return a.approvePatterns=[]}),c.getActivityStream().success(function(b){return a.myActivity=b instanceof Array?b.map(function(a){return{date:e.humanDate(new Date(a.time)),pretext:a.activitystring,linktext:a.patternid,url:a.linkstring,action:a.action,actor:a.actor,title:a.title,points:{value:a.points,text:1===Math.abs(a.points)?"point":"points","class":a.points<0?"danger":"success"}}}):[]}).error(function(){return a.myActivity=[]}),c.getRecentObservations().success(function(b){return a.recentObservations=b instanceof Array?b.map(function(a){return{user:{name:a.username,avatar:a.avatar||"http://www.gravatar.com/avatar/"+a.MD5email+"?d=identicon"},text:a.comment,url:a.linkstring}}):[]}).error(function(){return a.recentObservations=[]}),c.getDataExperts().success(function(b){var c;return b instanceof Array?(c=["gold","silver","bronze"],a.dataExperts=b.filter(function(a){return a.reputation>0}).map(function(a,b){var d;return d={rank:b+1,name:a.username,avatar:a.avatar||"http://www.gravatar.com/avatar/"+a.MD5email+"?d=identicon",score:a.reputation},d.rank<=3&&(d.rankclass=c[d.rank-1]),d})):a.dataExperts=[]}).error(function(){return a.dataExperts=[]})},a.search=function(){return b.path("/search/"+a.searchquery)},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("AdminUsersCtrl",["$scope","$location","Admin","Auth","Overview","config",function(a,b,c,d){a.modal={shown:!1,content:{title:null,type:null,item:null}},a.pagination={orderby:"uid",perPage:10,pageNumber:1,total:0},a.users=[],a.loading=!1,a.init=function(){return a.bootNonAdmins(),a.updateUsers()},a.bootNonAdmins=function(){return d.isAdmin()?void 0:b.path("/home")},a.updateUsers=function(b){var d;return null==b&&(b=function(){}),d=(a.pagination.pageNumber-1)*a.pagination.perPage,a.users.splice(0),a.loading=!0,c.getUsers(a.pagination.orderby,d,a.pagination.perPage).success(function(c){return a.loading=!1,c.count&&null!=c.users&&(c.users.forEach(function(b){return a.users.push({uid:b.uid||0,avatar:b.avatar||"",username:b.username||"",email:b.email||"",md5email:b.md5email||"",reputation:b.reputation||0,usertype:b.usertype||0,enabled:null==b.enabled?!0:b.enabled,password:""})}),a.pagination.total=c.count),b()}).error(function(){return a.loading=!1,1!==a.pagination.pageNumber?(a.pagination.pageNumber=1,a.updateObservations(b)):void 0})},a.showModal=function(b,c){null!=c&&(a.modal.content.type=b,a.modal.content.item=_.cloneDeep(c),a.modal.content.itemOriginal=c,a.modal.content.item.usertype=!!c.usertype,a.modal.shown=!0,$("#admin-modal").modal("show"))},a.closeModal=function(){a.modal.shown=!1,$("#admin-modal").modal("hide")},a.generateRandom=function(){return a.modal.content.item.password=function(){var a,b,c,d,e;for(a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012345679-_.",e="",b=c=0,d=12+Math.floor(8*Math.random());d>=0?d>=c:c>=d;b=d>=0?++c:--c)e+=a.charAt(Math.floor(Math.random()*a.length));return e}()},a.submitForm=function(){return"edit"===a.modal.content.type?a.edit():"disable"===a.modal.content.type?a.disable():void 0},a.edit=function(){var b,d,e;d=_.cloneDeep(a.modal.content.itemOriginal),b=_.cloneDeep(a.modal.content.item),b.usertype=parseInt(1*b.usertype),e=function(){var a;return a={},Object.keys(d).forEach(function(c){return"uid"===c||d[c]!==b[c]?a[c]="reputation"===c?b[c]-d[c]:b[c]:void 0}),a}(),Object.keys(e).length>1&&c.editUser(e).success(function(){return a.updateUsers(function(){return a.closeModal()})})},a.disable=function(){var b;b={uid:a.modal.content.item.uid,enabled:!a.modal.content.item.enabled},c.editUser(b).success(function(){return a.updateUsers(function(){return a.closeModal()})})},a.orderby=function(b){return a.pagination.orderby!==b?(a.pagination.orderby=b,a.pagination.pageNumber=1,a.updateUsers()):void 0},a.totalPages=function(b){return Math.ceil(b/a.pagination.perPage)},a.range=function(b){var c,d;return c=a.totalPages(b),0===c&&(c=1),function(){d=[];for(var a=1;c>=1?c>=a:a>=c;c>=1?a++:a--)d.push(a);return d}.apply(this)},a.changePage=function(b,c){var d;return d=null!=c?a.pagination.pageNumber+b:b,d>0&&d<=a.totalPages(a.pagination.total)?(a.pagination.pageNumber=d,a.updateUsers()):void 0}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("AdminObservationsCtrl",["$scope","$location","Admin","Auth","Overview","config",function(a,b,c,d){a.modal={shown:!1,content:{title:null,type:null,item:null}},a.pagination={flaggedonly:!1,orderby:"observation_id",perPage:10,pageNumber:1,total:0},a.observations=[],a.loading=!1,a.init=function(){return a.bootNonAdmins(),a.updateObservations()},a.bootNonAdmins=function(){return d.isAdmin()?void 0:b.path("/home")},a.updateObservations=function(b){var d;return null==b&&(b=function(){}),d=(a.pagination.pageNumber-1)*a.pagination.perPage,a.observations.splice(0),a.loading=!0,c.getObservations(a.pagination.orderby,d,a.pagination.perPage,a.pagination.flaggedonly).success(function(c){return a.loading=!1,c.count&&null!=c.comments&&(c.comments.forEach(function(b){return a.observations.push({observationid:b.observationid||0,created:b.created,comment:b.comment||0,uid:b.uid||0,username:b.username||"",rating:(b.credited||0)-(b.discredited||0),flagged:null==b.flagged?!1:b.flagged})}),a.pagination.total=c.count,1!==a.pagination.pageNumber&&0!==a.pagination.total&&0===a.observations.length)?(a.pagination.pageNumber=1,void a.updateObservations(b)):b()}).error(function(){return a.loading=!1,1!==a.pagination.pageNumber?(a.pagination.pageNumber=1,a.updateObservations(b)):void 0})},a.humanDate=function(a){var b,c,d;return c=["Sun","Mon","Tues","Wed","Thu","Fri","Sat"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b=new Date(a),"Invalid Date"===b.toString()&&(b=new Date(0)),c[b.getDay()]+" "+b.getDate()+" "+d[b.getMonth()]+", "+b.getFullYear()},a.showModal=function(b,c){null!=c&&(a.modal.content.type=b,a.modal.content.item=_.cloneDeep(c),a.modal.content.itemOriginal=c,a.modal.shown=!0,$("#admin-modal").modal("show"))},a.closeModal=function(){a.modal.shown=!1,$("#admin-modal").modal("hide")},a.generateRandom=function(){return a.modal.content.item.password=function(){var a,b,c,d,e;for(a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012345679-_.",e="",b=c=0,d=12+Math.floor(8*Math.random());d>=0?d>=c:c>=d;b=d>=0?++c:--c)e+=a.charAt(Math.floor(Math.random()*a.length));return e}()},a.submitForm=function(){return"edit"===a.modal.content.type?a.edit():"disable"===a.modal.content.type?a.disable():void 0},a["delete"]=function(){c.deleteObservation(a.modal.content.item.observationid).success(function(){return a.updateObservations(function(){return a.closeModal()})})},a.orderby=function(b){return a.pagination.orderby!==b?(a.pagination.orderby=b,a.pagination.pageNumber=1,a.updateObservations()):void 0},a.totalPages=function(b){return Math.ceil(b/a.pagination.perPage)},a.range=function(b){var c,d;return c=a.totalPages(b),0===c&&(c=1),function(){d=[];for(var a=1;c>=1?c>=a:a>=c;c>=1?a++:a--)d.push(a);return d}.apply(this)},a.changePage=function(b,c){var d;return d=null!=c?a.pagination.pageNumber+b:b,d>0&&d<=a.totalPages(a.pagination.total)?(a.pagination.pageNumber=d,a.updateObservations()):void 0},a.setFilter=function(b){return a.pagination.flaggedonly=b,a.updateObservations()}}])}.call(this);