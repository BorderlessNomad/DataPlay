(function(){"use strict";angular.module("dataplayApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ipCookie","angularDc","nvd3"]),angular.module("dataplayApp").constant("config",{sessionHeader:"X-API-SESSION",sessionName:"DPSession",userName:"DPUser",api:{base_url:"http://localhost:3000/api"}})}).call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(a){this.bubbleChartPostSetup=b(this.bubbleChartPostSetup,this),this.pieChartPostSetup=b(this.pieChartPostSetup,this),this.columnChartPostSetup=b(this.columnChartPostSetup,this),this.rowChartPostSetup=b(this.rowChartPostSetup,this),this.lineChartPostSetup=b(this.lineChartPostSetup,this),this.humanDate=b(this.humanDate,this),this.chartsRelated=a}return a.prototype.allowed=["line","bar","row","column","pie","bubble"],a.prototype.count=3,a.prototype.loading={related:!1},a.prototype.offset={related:0},a.prototype.limit={related:!1},a.prototype.max={related:0},a.prototype.chartsRelated=[],a.prototype.xTicks=6,a.prototype.width=275,a.prototype.height=200,a.prototype.margin={top:10,right:10,bottom:30,left:70},a.prototype.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a.prototype.humanDate=function(a){return""+a.getDate()+" "+this.monthNames[a.getMonth()]+", "+a.getFullYear()},a.prototype.findById=function(a){var b;return b=_.where(this.chartsRelated,{id:a}),null!=(null!=b?b[0]:void 0)?b[0]:null},a.prototype.isPlotAllowed=function(a){return c.call(this.allowed,a)>=0?!0:!1},a.prototype.hasRelatedCharts=function(){return Object.keys(this.chartsRelated).length},a.prototype.getXScale=function(a){var b;return b=function(){switch(a.patterns[a.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,this.width]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.key})).range([0,this.width]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.key)})).range([0,this.width])}}.call(this)},a.prototype.getXUnits=function(a){var b;return b=function(){switch(a.patterns[a.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()},a.prototype.getYScale=function(a){var b;return b=function(){switch(a.patterns[a.yLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,this.height]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.value})).range([0,this.height]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.value)})).range([0,this.height]).nice()}}.call(this)},a.prototype.lineChartPostSetup=function(a){var b,d,e,f,g;for(d=this.findById(a.anchorName()),d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){return a.x}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],g=d.group.all(),e=0,f=g.length;f>e;e++)b=g[e],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key);a.colorAccessor(function(a){return parseInt(a.y)%d.ordinals.length}),a.xAxis().ticks(this.xTicks),a.xAxisLabel(!1,0),a.yAxisLabel(!1,0),a.x(this.getXScale(d))},a.prototype.rowChartPostSetup=function(a){var b,d,e,f,g,h;for(d=this.findById(a.anchorName()),d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){return a.x}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],g=d.group.all(),e=0,f=g.length;f>e;e++)b=g[e],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key);a.colorAccessor(function(a,b){return b+1}),a.xAxis().ticks(this.xTicks),a.x(this.getYScale(d)),(null!=(h=d.ordinals)?h.length:void 0)>0&&a.xUnits(this.getXUnits(d))},a.prototype.columnChartPostSetup=function(a){var b,d,e,f,g,h;for(d=this.findById(a.anchorName()),d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){return a.x}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],g=d.group.all(),e=0,f=g.length;f>e;e++)b=g[e],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key);a.colorAccessor(function(a,b){return b+1}),a.xAxis().ticks(this.xTicks),a.x(this.getXScale(d)),(null!=(h=d.ordinals)?h.length:void 0)>0&&a.xUnits(this.getXUnits(d))},a.prototype.pieChartPostSetup=function(a){var b;b=this.findById(a.anchorName()),b.entry=crossfilter(b.values),b.dimension=b.entry.dimension(function(a){return function(c){var d;return"date"===b.patterns[b.xLabel].valuePattern?a.humanDate(c.x):d=null!=c.x&&(c.x.length>0||"date"===b.patterns[b.xLabel].valuePattern)?c.x:"N/A"}}(this)),b.groupSum=0,b.group=b.dimension.group().reduceSum(function(a){var c;return c=Math.abs(parseFloat(a.y)),b.groupSum+=c,c}),a.dimension(b.dimension),a.group(b.group),a.colorAccessor(function(a,b){return b+1}),a.renderLabel(!1)},a.prototype.bubbleChartPostSetup=function(a){var b,d,e,f,g,h,i,j,k,l,m;for(d=this.findById(a.anchorName()),g=null,e=null,d.entry=crossfilter(d.values),d.dimension=d.entry.dimension(function(a){var b;return b=Math.abs(parseInt(a.z)),(null==g||g>b)&&(g=0===b?1:b),(null==e||b>=e)&&(e=0===b?1:b),""+a.x+"|"+a.y+"|"+a.z}),d.group=d.dimension.group().reduceSum(function(a){return a.y}),a.dimension(d.dimension),a.group(d.group),d.ordinals=[],m=d.group.all(),k=0,l=m.length;l>k;k++)b=m[k],c.call(d.ordinals,b)<0&&d.ordinals.push(b.key.split("|")[0]);a.keyAccessor(function(a){return a.key.split("|")[0]}),a.valueAccessor(function(a){return a.key.split("|")[1]}),a.radiusValueAccessor(function(a){var b;return b=Math.abs(parseInt(a.key.split("|")[2])),b>=g?b:g}),a.x(function(){switch(d.patterns[d.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(d.ordinals).rangeBands([0,this.width]);case"date":return d3.time.scale().domain(d3.extent(d.group.all(),function(a){return a.key.split("|")[0]})).range([0,this.width]);default:return d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return parseInt(a.key.split("|")[0])})).range([0,this.width])}}.call(this)),a.y(function(){switch(d.patterns[d.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(d.ordinals).rangeBands([0,this.height]);case"date":return d3.time.scale().domain(d3.extent(d.group.all(),function(a){return a.key.split("|")[1]})).range([0,this.height]);default:return d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return parseInt(a.key.split("|")[1])})).range([0,this.height])}}.call(this)),i=d3.scale.linear().domain(d3.extent(d.group.all(),function(a){return Math.abs(parseInt(a.key.split("|")[2]))})),a.r(i),a.xAxis().ticks(this.xTicks),a.title(function(a){var b,c,e;return b=a.key.split("|")[0],c=a.key.split("|")[1],e=a.key.split("|")[2],""+d.xLabel+": "+b+"\n"+d.yLabel+": "+c+"\n"+d.zLabel+": "+e}),h=Math.log(g),f=Math.log(e),j=Math.abs(Math.log((f-h)/(e-g))),a.maxBubbleRelativeSize(j/100)},a}(),window.RelatedCharts=a}.call(this),function(){"use strict";var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};c={margin:{top:15,bottom:25,right:55,left:55},xTicks:8},e={bar:"column",area:"line"},d=function(a){return function(b){return"none"===a?"":"date"===a?d3.time.format("%d-%m-%Y")(new Date(b)):d3.format(",f")(b)}},b={line:{chart:{type:"multiChart",height:450,margin:_.cloneDeep(c.margin),x:function(a,b){return b},y:function(a){return a[1]},color:d3.scale.category10().range(),transitionDuration:250,xAxis:{axisLabel:"",showMaxMin:!1,tickFormat:d(),ticks:c.xTicks},yAxis1:{orient:"left",axisLabel:"",tickFormat:d(),showMaxMin:!1,highlightZero:!1},yAxis2:{orient:"right",axisLabel:"",tickFormat:d(),showMaxMin:!1,highlightZero:!1},yDomain1:[0,1e3],yDomain2:[0,1e3]}},column:{chart:{type:"multiChart",height:450,margin:_.cloneDeep(c.margin),x:function(a,b){return b},y:function(a){return a[1]},color:d3.scale.category10().range(),transitionDuration:250,xAxis:{axisLabel:"",showMaxMin:!1,tickFormat:d(),ticks:c.xTicks},yAxis1:{orient:"left",axisLabel:"",tickFormat:d(),showMaxMin:!1,highlightZero:!1},yAxis2:{orient:"right",axisLabel:"",tickFormat:d(),showMaxMin:!1,highlightZero:!1},bars1:{groupSpacing:.5},bars2:{groupSpacing:.5},yDomain1:[0,1e3],yDomain2:[0,1e3]}},scatter:{chart:{type:"scatterChart",height:450,margin:_.cloneDeep(c.margin),color:d3.scale.category10().range(),scatter:{onlyCircles:!0},transitionDuration:250,xAxis:{axisLabel:"",showMaxMin:!1,tickFormat:d(),ticks:c.xTicks},yAxis:{axisLabel:"",showMaxMin:!1,tickFormat:d(),highlightZero:!1},yAxis1:{},yAxis2:{},yDomain1:[0,1e3],yDomain2:[0,1e3]}}},a=function(){function a(a,b){null==b&&(b=[]),this.translateData=f(this.translateData,this),this.setTooltips=f(this.setTooltips,this),this.setLegend=f(this.setLegend,this),this.setMargin=f(this.setMargin,this),this.setSize=f(this.setSize,this),this.setAxisTypes=f(this.setAxisTypes,this),this.generate=f(this.generate,this),null!=a&&this.generate(a,b)}return a.prototype.type="",a.prototype.options={},a.prototype.data=[],a.prototype.error=null,a.prototype.info={},a.prototype.generate=function(a,c){return null==c&&(c=[]),null!=a&&null!=e[a]&&(a=e[a]),null!=a&&null!=b[a]?(this.type=a,this.options=_.cloneDeep(b[a]),this.data=c):this.error="Type not supported"},a.prototype.setAxisTypes=function(a,b,c){var e,f;return e={xAxis:a,yAxis1:b,yAxis2:c},null!=(null!=(f=this.options)?f.chart:void 0)?Object.keys(e).forEach(function(a){return function(b){return e[b]?a.options.chart[b].tickFormat=d(e[b]):void 0}}(this)):void 0},a.prototype.setSize=function(a,b){var c;return null!=(null!=(c=this.options)?c.chart:void 0)&&(null!=a&&(this.options.chart.width=a),null!=b)?this.options.chart.height=b:void 0},a.prototype.setMargin=function(a,b,c,d){var e,f;return null!=(null!=(e=this.options)&&null!=(f=e.chart)?f.margin:void 0)&&(null!=a&&(this.options.chart.margin.top=a),null!=b&&(this.options.chart.margin.bottom=b),null!=c&&(this.options.chart.margin.left=c),null!=d)?this.options.chart.margin.right=d:void 0},a.prototype.setLegend=function(a){var b;return null!=(null!=(b=this.options)?b.chart:void 0)&&null!=a&&"boolean"==typeof a?this.options.chart.showLegend=a:void 0},a.prototype.setTooltips=function(a){var b;return null!=(null!=(b=this.options)?b.chart:void 0)&&null!=a&&"boolean"==typeof a?this.options.chart.tooltips=a:void 0},a.prototype.translateData=function(a,b){var c;return c=function(a){if("string"==typeof a){if(!isNaN(Date.parse(a)))return Date.parse(a);if(!isNaN(parseFloat(a)))return parseFloat(a)}return a},a.map(function(a){var d;return d={x:c(a.x||0),y:parseFloat(a.y||0)},"scatter"===b&&(d.size=3,d.shape="circle"),d})},a}(),window.CorrelatedChart=a}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(c,d){null==c&&(c=""),null==d&&(d=[]),this.unhighlight=b(this.unhighlight,this),this.highlight=b(this.highlight,this),this.getColor=b(this.getColor,this),this.appendCounty=b(this.appendCounty,this),this.generate=b(this.generate,this),this.selector=c,this.data=d,$.getJSON("../regions.json",function(b){return a.prototype.boundaryPaths=b})}return a.prototype.selector="",a.prototype.data=[],a.prototype.width=156,a.prototype.height=168,a.prototype.maxvalue=50,a.prototype.generate=function(a){var b,c,d;return a?this.data=a:a=this.data,b=d3.select(this.selector),c=b.append("svg").attr("width",this.width).attr("height",this.height),d=c.append("g").attr("transform","translate("+this.width/2+", "+this.height/2+")"),a.forEach(function(a){return function(b){return a.appendCounty(d,b)}}(this))},a.prototype.appendCounty=function(a,b){var c;return c=this.displayNameDictionary[b.name.toLowerCase()],null==c&&(c=b.name.toLowerCase().replace(/^(ire)/g,""),c=c.substring(0,1).toUpperCase()+c.substring(1)),a.append("g").attr("class","county").attr("id","county-"+b.name).append("path").attr("fill",this.getColor(b)).attr("d",this.boundaryPaths[b.name]).append("title").html(""+c+": "+b.value)},a.prototype.getColor=function(a,b){var c,d,e,f;return f="object"==typeof a?a.value||0:a||0,f/=b||this.maxvalue,"object"==typeof a&&"ire"===a.name.substring(0,3)?"#CCCCCC":0===f?"#FFE455":(e={r:255,g:228,b:85},c={r:186,g:63,b:60},d={},Object.keys(e).forEach(function(a){return d[a]=Math.round(e[a]+(c[a]-e[a])*f)}),"#"+d.r.toString(16)+d.g.toString(16)+d.b.toString(16))},a.prototype.highlight=function(a){return d3.select("#"+a+" path").style("fill-opacity",.8)},a.prototype.unhighlight=function(a){return d3.select("#"+a+" path").style("fill-opacity",null)},a.prototype.locationDictionary={glasgow:"strathclyde",edinburgh:"lothian",london:"greaterlondon",manchester:"greatermanchester",birmingham:"westmidlands",leeds:"westyorkshire",sheffield:"northyorkshire",liverpool:"merseyside",cardiff:"southglamorgan"},a.prototype.displayNameDictionary={dumfriesandgalloway:"Dumfries and Galloway",eastsussex:"East Sussex",greaterlondon:"London",greatermanchester:"Manchester",herefordandworcester:"Hereford and Worcester",isleofwight:"Isle of Wight",midglamorgan:"Mid Glamorgan",northyorkshire:"North Yorkshire",orkneyislands:"Orkney Islands",scottishborders:"Scottish Borders",southglamorgan:"South Glamorgan",southyorkshire:"South Yorkshire",tyneandwear:"Tyne and Wear",westernisles:"Western Isles",westglamorgan:"West Glamorgan",westmidlands:"West Midlands",westsussex:"West Sussex",westyorkshire:"West Yorkshire",northernireland:"Northern Ireland"},a.prototype.boundaryPaths={},a}(),window.MapGenerator=a}.call(this),function(){"use strict";angular.module("dataplayApp").directive("match",[function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(a,b,c,d){a.$watch(function(){return d.$pristine&&angular.isUndefined(d.$modelValue)||a.match===d.$modelValue},function(a){d.$setValidity("match",a)})}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").filter("truncate",[function(){return function(a,b,c,d){var e;return null==b&&(b=10),null==c&&(c=!1),null==d&&(d=" ..."),null==a?"":a.length<=b?a:(a=a.substr(0,b),c&&(e=a.lastIndexOf(" "),-1!==e&&(a=a.substr(0,e))),""+a+d)}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Auth",["ipCookie","config",function(a,b){return{get:function(b){var c;return c=a(b),null!=c?c:!1},set:function(b,c){return a(b,c,{expires:31536e3,expirationUnit:"seconds"})},remove:function(b){return a.remove(b)},isAuthenticated:function(){var c;return c=a(b.sessionName),null!=c&&c.length?!0:!1}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("User",["$http","Auth","config",function(a,b,c){return{logIn:function(b,d){return a.post(c.api.base_url+"/login",{username:b,password:d})},logOut:function(){return a["delete"](c.api.base_url+"/logout")},register:function(b,d){return a.post(c.api.base_url+"/register",{username:b,password:d})},check:function(b){return a.post(c.api.base_url+"/user/check",{username:b})},forgotPassword:function(b){return a.post(c.api.base_url+"/user/forgot",{username:b})},token:function(b,d,e){return null!=e?a.put(c.api.base_url+("/user/reset/"+b),{username:d,password:e}):a.get(c.api.base_url+("/user/reset/"+b+"/"+d))},resetPassword:function(b,d){return a.post(c.api.base_url+"/user/reset",{hash:b,password:d})},visited:function(){return a.get(c.api.base_url+"/visited")},search:function(b,d,e){var f;return f="/search/"+b,null!=d&&(f+="/"+d,null!=e&&(f+="/"+e)),a.get(c.api.base_url+f)},getNews:function(b){return b instanceof Array&&(b=b.join("_")),a.get(c.api.base_url+("/news/search/"+b))}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Tracker",["$http","config",function(a,b){return{visited:function(c,d,e,f,g){return a.post(b.api.base_url+"/visited",{guid:c,info:{key:d,type:e,x:f,y:g}})}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Overview",["$http","config",function(a,b){var c,d,e;return e=d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!==a.getDate()}],["%b %d",function(a){return 1!==a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]),c={},d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],{charts:function(a,b){return null==a?(c={},null):(null!=b&&(c[a]=b),null!=c[a]?c[a]:null)},humanDate:function(a){return""+a.getDate()+" "+d[a.getMonth()]+", "+a.getFullYear()},getRandomInteger:function(a,b){return Math.floor(Math.random()*(b-a)+a)},info:function(c){return a.get(b.api.base_url+("/chartinfo/"+c))},reducedData:function(c,d,e){return a.get(b.api.base_url+("/getreduceddata/"+c+"/"+d+"/"+e))},related:function(c,d,e){return d=null!=d?d:0,e=null!=e?e:3,a.get(b.api.base_url+("/related/"+c+"/"+d+"/"+e))},correlated:function(c,d,e,f){return d=null!=d?d:0,e=null!=e?e:3,f=null!=f?f:100,a.get(b.api.base_url+("/correlated/"+c+"/"+d+"/"+e+"/"+f))}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Charts",["$http","config",function(a,b){return{related:function(c,d,e,f,g,h){var i;return i="/chart/"+c+"/"+d+"/"+e+"/"+f+"/"+g,null!=h&&(i+="/"+h),a.get(b.api.base_url+i)},correlated:function(c){return a.get(b.api.base_url+("/chartcorrelated/"+c))},bookmark:function(c){return a.post(b.api.base_url+"/setbookmark",{data:c})},creditChart:function(c,d,e){var f;return f="boolean"==typeof e?"/chart/"+e:"/chart","rid"===c?a.put(b.api.base_url+f,{rid:d}):a.put(b.api.base_url+f,{cid:d})},getObservations:function(c){return a.get(b.api.base_url+("/observations/"+c))},createObservation:function(c,d,e,f){return a.put(b.api.base_url+"/observations",{did:""+c,x:""+d,y:""+e,comment:f})},creditObservation:function(c,d){return a.put(b.api.base_url+("/observations/"+c+"/"+d))}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").config(["$httpProvider",function(a){return a.interceptors.push("RequestInterceptor")}]).factory("RequestInterceptor",["$q","Auth","config",function(a,b,c){return{request:function(d){return d.headers[c.sessionHeader]=b.get(c.sessionName),d||a.when(d)}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("PatternMatcher",function(){var a,b,c,d;return a=[{name:"creditCard",handlers:[{pattern:/^(4\d{3}[-]*\d{4}[-]*\d{4}[-]*\d(?:\d{3})?)|(5[1-5]\d{2}[-]*\d{4}[-]*\d{4}[-]*\d{4})|(6(?:011|5[0-9]{2})[-]*\d{4}[-]*\d{4}[-]*\d{4})|(3[47]\d{2}[-]*\d{6}[-]*\d{5})|(3(?:0[0-5]|[68][0-9])\d[-]*\d{6}[-]*\d{4})|((?:2131|1800)[-]*\d{6}[-]*\d{5}|35\d{2}[-]*\d{4}[-]*\d{4}[-]*\d{4})$/i}]},{name:"url",handlers:[{pattern:/^(#Scheme[a-z][a-z0-9+\-.]*:(#Authority&path\/\/([a-z0-9\-._~%!$&'()*+,;=]+@)?([a-z0-9\-._~%]+|\[[a-f0-9:.]+\]|\[v[a-f0-9][a-z0-9\-._~%!$&'()*+,;=:]+\])(:[0-9]+)?(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?|#Pathwithoutauthority(\/?[a-z0-9\-._~%!$&'()*+,;=:@]+(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?)?)|#RelativeURL(noschemeorauthority)([a-z0-9\-._~%!$&'()*+,;=@]+(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)*\/?|(\/[a-z0-9\-._~%!$&'()*+,;=:@]+)+\/?))(\?[a-z0-9\-._~%!$&'()*+,;=:@\/?]*)?(\#[a-z0-9\-._~%!$&'()*+,;=:@\/?]*)?$/i}]},{name:"email",handlers:[{pattern:/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i}]},{name:"domain",handlers:[{pattern:/^\b((?=[a-z0-9-]{1,63}\.)(xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,63}\b$/i}]},{name:"ipv4",handlers:[{pattern:/\b(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b/i}]},{name:"nin",handlers:[{pattern:/\b[abceghj-prstw-z][abceghj-nprstw-z] ?\d{2} ?\d{2} ?\d{2} ?[a-dfm]?\b/i}]},{name:"postCode",handlers:[{pattern:/\b[A-Z]{1,2}[0-9][A-Z0-9]? [0-9][ABD-HJLNP-UW-Z]{2}\b/i}]},{name:"vat",handlers:[{pattern:/^(GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})$/i}]},{name:"currency",handlers:[{pattern:/^[+-]?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{2})?|(?:,[0-9]{3})*(?:\.[0-9]{2})?|(?:\.[0-9]{3})*(?:,[0-9]{2})?)£€\$$/i}]},{name:"date",handlers:[{pattern:/^[^0-9]*(((19|20)?\d\d)-)?((0)?([1-9])|1[012])-((0)?([1-9])|[12][0-9]|3[01])[^0-9]*$/,parse:function(){return function(a){return c(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9])}}(this)}]},{name:"intNumber",handlers:[{pattern:/^[-+]?\d+$/i,parse:function(){return function(a){return parseInt(a)}}(this)}]},{name:"floatNumber",handlers:[{pattern:/^[-+]?\b[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?\b$/i,parse:function(){return function(a){return parseFloat(a)}}(this)}]},{name:"percent",handlers:[{pattern:/^\b[0-9]+(\.[0-9]+)?%\b$/i,parse:function(){return function(a){return parseFloat(a)}}(this)}]},{name:"label",handlers:[{pattern:/^[a-zA-Z]{1}.{0,63}$/i}]},{name:"text",handlers:[{pattern:/^.*$/i}]}],b=[{name:"identifier",pattern:/id|account|ref|((credit\b)?card)|(post\bcode)/i},{name:"date",pattern:/date|year|day/i},{name:"coefficient",pattern:/^coef|ind|ratio|percent|count$/i},{name:"mapLongitude",pattern:/^(lon|ln|lng|long|longitud|longitude)$/i},{name:"mapLatitude",pattern:/^(lat|lt|ltt|latit|latitud|latitude)$/i}],d=function(a){var b;return b=function(){switch(a){case"Jan":case"January":case"jan":case"january":return"01";case"Feb":case"February":case"feb":case"february":return"02";case"Mar":case"March":case"mar":case"march":return"03";case"Apr":case"April":case"apr":case"april":return"04";case"May":case"may":return"05";case"Jun":case"June":case"jun":case"june":return"06";case"Jul":case"July":case"jul":case"july":return"07";case"Aug":case"August":case"aug":case"august":return"08";case"Sep":case"September":case"sep":case"september":return"09";case"Oct":case"October":case"oct":case"october":return"10";case"Nov":case"November":case"nov":case"november":return"11";case"Dec":case"December":case"dec":case"december":return"12";default:return null}}()},c=function(a,b,c,d,e,f,g){return new Date(b,d-1,g)},{getPattern:function(b){var c,d,e,f,g;for(d=null,e=function(a){var c,e,f,g,h;if(!d){for(g=a.handlers,h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(function(c){var e;return!d&&(e=c.pattern.exec(b))?d=a.name:void 0}(c));return h}},f=0,g=a.length;g>f;f++)c=a[f],e(c);return d},getKeyPattern:function(a){var c,d,e,f,g;for(d=null,e=function(b){var c;return!d&&(c=b.pattern.exec(a))?d=b.name:void 0},f=0,g=b.length;g>f;f++)c=b[f],e(c);return d},parse:function(b,c){var d,e,f,g;for(e=null,f=0,g=a.length;g>f;f++)d=a[f],d.name===c&&!function(a){var c,d,f,g,h;for(g=a.handlers,h=[],d=0,f=g.length;f>d;d++)c=g[d],h.push(function(a){var c;return!e&&(c=a.pattern.exec(b))?e=a.parse?a.parse(c):b:void 0}(c));return h}(d);return e},includePattern:function(a,b){var c;return c=function(){switch(a){case"excluded":return!1;case"label":case"date":case"postCode":case"creditCard":case"currency":return!0;case"intNumber":case"floatNumber":switch(b){case"date":case"coefficient":return!0;case null:return!0;default:return!1}break;default:return!1}}()}}})}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Profile",["$http","Auth","config",function(a,b,c){return{getInfo:function(){return a.get(c.api.base_url+"/user")},setInfo:function(b,d){return a.put(c.api.base_url+"/user",{email:b,username:d})},getCreditDiscoveries:function(){return a.get(c.api.base_url+"/profile/credited")},getDiscoveries:function(){return a.get(c.api.base_url+"/profile/discoveries")},getObservations:function(){return a.get(c.api.base_url+"/profile/observations")}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("OverviewScreen",["$http","Auth","config",function(a,b,c){return{get:function(b){return null==b&&(b="d"),a.get(c.api.base_url+("/political/"+b))}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").factory("Home",["$http","Auth","config",function(a,b,c){return{getStats:function(){return a.get(c.api.base_url+"/home/data")},getTopRated:function(){return a.get(c.api.base_url+"/chart/toprated")},getAwaitingCredit:function(){return a.get(c.api.base_url+"/chart/awaitingcredit")},getActivityStream:function(){return a.get(c.api.base_url+"/user/activitystream")},getRecentObservations:function(){return a.get(c.api.base_url+"/recentobservations")},getDataExperts:function(){return a.get(c.api.base_url+"/user/experts")}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").config(["$routeProvider","$locationProvider","$provide",function(a,b){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",login:!0}).when("/",{templateUrl:"views/landing.html",controller:"LandingCtrl",login:!1}).when("/about",{templateUrl:"views/about.html",controller:"LandingCtrl",login:!1}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl",login:!0,preventReload:!0}).when("/search/:query",{templateUrl:"views/search.html",controller:"SearchCtrl",login:!0,preventReload:!0}).when("/overview",{templateUrl:"views/overviewscreen.html",controller:"OverviewScreenCtrl",login:!0}).when("/overview/:id",{templateUrl:"views/overview.html",controller:"OverviewCtrl",login:!0}).when("/overview/:id/:offset/:count",{templateUrl:"views/overview.html",controller:"OverviewCtrl",login:!0}).when("/charts/related/:id/:key/:type/:x/:y",{templateUrl:"views/charts.html",controller:"ChartsRelatedCtrl",login:!0}).when("/charts/related/:id/:key/:type/:x/:y/:z",{templateUrl:"views/charts.html",controller:"ChartsRelatedCtrl",login:!0}).when("/charts/correlated/:id/:correlationid/:type/:x/:y",{templateUrl:"views/charts.html",controller:"ChartsCorrelatedCtrl",login:!0}).when("/charts/correlated/:id/:correlationid/:type/:x/:y/:z",{templateUrl:"views/charts.html",controller:"ChartsCorrelatedCtrl",login:!0}).when("/map/:id",{templateUrl:"views/map.html",controller:"MapCtrl",login:!0}).when("/user/login",{templateUrl:"views/user/login.html",login:!1}).when("/user/logout",{templateUrl:"views/user/login.html",controller:"UserCtrl",login:!0}).when("/user/forgotpassword",{templateUrl:"views/user/forgot-password.html",controller:"UserCtrl",login:!1}).when("/user/resetpassword/:token",{templateUrl:"views/user/reset-password.html",controller:"UserCtrl",login:!1}).when("/user/register",{templateUrl:"views/user/register.html",login:!1}).when("/user",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",login:!0}).when("/user/:tab",{templateUrl:"views/user/profile.html",controller:"ProfileCtrl",login:!0}).otherwise({redirectTo:"/"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("dataplayApp").run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){null!=d&&d.login&&!c.isAuthenticated()&&b.path("/user/login")})}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("RecentCtrl",["$scope","$location","User","Auth","Overview","config",function(a,b,c,d,e,f){a.Auth=d,a.username=d.get(f.userName),a.config=f,a.lastVisited=[],a.isActive=function(a){return b.path().substr(0,a.length)===a},a.getLastVisited=function(){return e.charts(null),d.isAuthenticated()?void c.visited().success(function(b){a.lastVisited=b}).error(function(a){console.log("Home::Visited::Error:",a)}):void(a.lastVisited=[])}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("SearchCtrl",["$scope","$location","$routeParams","User","Overview","PatternMatcher",function(a,b,c,d,e,f){a.query=null!=c.query?c.query:"",a.results=[],a.rowedResults=[],a.totalResults=0,a.rowLimit=3,a.overview=[],a.chartsRelated=[],a.relatedChart=new RelatedCharts(a.chartsRelated),a.init=function(b){return null==b&&(b=!1),b&&(a.chartsRelated=[],a.totalResults,a.relatedChart.chartsRelated=a.chartsRelated),a.search(),a.getNews()},a.search=function(b,c){null==b&&(b=0),null==c&&(c=9),a.query.length<3||(a.loading.related=!0,d.search(a.query,b,c).success(function(c){a.loading.related=!1,a.results=0===b?c.Results:a.results.concat(c.Results),a.results.forEach(function(b){return b.graph=[],b.error=null,a.getRelated(b.GUID,0)}),a.rowedResults=a.splitIntoRows(a.results),a.totalResults=c.Total}).error(function(b){a.loading.related=!1,console.log("Search::search::Error:",b)}))},a.getNews=function(){return a.query.length<3?void 0:d.getNews(a.query).success(function(b){return b instanceof Array?a.overview=b.map(function(a){return{date:e.humanDate(new Date(a.date)),title:a.title,url:a.url,thumbnail:a.image_url}}):void 0}).error(function(a){console.log("Search::getNews::Error:",a)})},a.splitIntoRows=function(a,b){var c,d,e,f,g,h,i;for(null==b&&(b=3),g=[],e=h=0,i=a.length;i>h;e=++h)d=a[e],f=Math.floor(e/b),c=e%b,g[f]||(g[f]=[]),g[f][c]=d;return g},a.showMore=function(){return a.rowLimit+=2,a.rowedResults.length<a.rowLimit?a.search(3*(a.rowLimit-1),9):void 0},a.collapse=function(a){return a.show=!1},a.uncollapse=function(a){return a.show=!0},a.getRelated=function(b,c){e.related(b,c,1).success(function(c){var d,e,g,h,i,j,k;if(null!=c&&null!=c.charts&&c.charts.length>0){j=c.charts;for(e in j)if(d=j[e],a.relatedChart.isPlotAllowed(d.type)){if(e=parseInt(e),d.guid=b,d.key=e,d.id="related-"+b+"-"+(d.key+a.offset.related)+"-"+d.type,d.url="charts/related/"+b+"/"+d.key+"/"+d.type+"/"+d.xLabel+"/"+d.yLabel,"bubble"===d.type&&(d.url+="/"+d.zLabel),d.patterns={},d.patterns[d.xLabel]={valuePattern:f.getPattern(d.values[0].x),keyPattern:f.getKeyPattern(d.values[0].x)},"date"===d.patterns[d.xLabel].valuePattern)for(k=d.values,e=h=0,i=k.length;i>h;e=++h)g=k[e],d.values[e].x=new Date(g.x);null!=d.yLabel&&(d.patterns[d.yLabel]={valuePattern:f.getPattern(d.values[0].y),keyPattern:f.getKeyPattern(d.values[0].y)}),f.includePattern(d.patterns[d.xLabel].valuePattern,d.patterns[d.xLabel].keyPattern)&&a.chartsRelated.push(d)}console.log(a.chartsRelated)}}).error(function(b,c){a.loading.related=!1,console.log("Overview::getRelated::Error:",c)})},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.loading=a.relatedChart.loading,a.offset=a.relatedChart.offset,a.limit=a.relatedChart.limit,a.max=a.relatedChart.max,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("OverviewCtrl",["$scope","$routeParams","Overview",function(a,b,c){return a.params=b,a.info={name:a.params.id,title:a.params.id},a.info=function(){return c.info(a.params.id).success(function(b){a.info=b,console.log(a.info)}).error(function(a,b){console.log("Overview::info::Error:",b)})}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("OverviewRelatedCtrl",["$scope","$routeParams","Overview","PatternMatcher",function(b,c,d,e){b.allowed=["line","bar","row","column","pie","bubble"],b.params=c,b.count=3,b.loading={related:!1},b.offset={related:0},b.limit={related:!1},b.max={related:0},b.chartsRelated=[],b.xTicks=6,b.width=350,b.height=200,b.margin={top:10,right:10,bottom:30,left:70},b.findById=function(a){var c;return c=_.where(b.chartsRelated,{id:a}),null!=(null!=c?c[0]:void 0)?c[0]:null},b.isPlotAllowed=function(c){return a.call(b.allowed,c)>=0?!0:!1},b.getRelatedCharts=function(){b.getRelated(d.charts("related"))},b.hasRelatedCharts=function(){return Object.keys(b.chartsRelated).length},b.getRelated=function(a){b.loading.related=!0,null==a&&(a=b.max.related-b.offset.related,a=b.max.related&&a<b.count?a:b.count),d.related(b.params.id,b.offset.related,a).success(function(c){var f,g,h,i,j,k,l;if(b.loading.related=!1,null!=c&&null!=c.charts&&c.charts.length>0){b.max.related=c.count,k=c.charts;
for(g in k)if(f=k[g],b.isPlotAllowed(f.type)){if(g=parseInt(g),f.key=g,f.id="related-"+b.params.id+"-"+(f.key+b.offset.related)+"-"+f.type,f.url="charts/related/"+b.params.id+"/"+f.key+"/"+f.type+"/"+f.xLabel+"/"+f.yLabel,"bubble"===f.type&&(f.url+="/"+f.zLabel),f.patterns={},f.patterns[f.xLabel]={valuePattern:e.getPattern(f.values[0].x),keyPattern:e.getKeyPattern(f.values[0].x)},"date"===f.patterns[f.xLabel].valuePattern)for(l=f.values,g=i=0,j=l.length;j>i;g=++i)h=l[g],f.values[g].x=new Date(h.x);null!=f.yLabel&&(f.patterns[f.yLabel]={valuePattern:e.getPattern(f.values[0].y),keyPattern:e.getKeyPattern(f.values[0].y)}),e.includePattern(f.patterns[f.xLabel].valuePattern,f.patterns[f.xLabel].keyPattern)&&b.chartsRelated.push(f)}console.log(b.chartsRelated),b.offset.related+=a,b.offset.related>=b.max.related&&(b.limit.related=!0),d.charts("related",b.offset.related)}}).error(function(a,c){b.loading.related=!1,console.log("Overview::getRelated::Error:",c)})},b.getXScale=function(a){var c;return c=function(){switch(a.patterns[a.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,b.width]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.key})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.key)})).range([0,b.width])}}()},b.getXUnits=function(a){var b;return b=function(){switch(a.patterns[a.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()},b.getYScale=function(a){var c;return c=function(){switch(a.patterns[a.yLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,b.height]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.value})).range([0,b.height]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.value)})).range([0,b.height]).nice()}}()},b.lineChartPostSetup=function(c){var d,e,f,g,h;for(e=b.findById(c.anchorName()),e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a){return parseInt(a.y)%e.ordinals.length}),c.xAxis().ticks(b.xTicks),c.xAxisLabel(!1,0),c.yAxisLabel(!1,0),c.x(b.getXScale(e))},b.rowChartPostSetup=function(c){var d,e,f,g,h,i;for(e=b.findById(c.anchorName()),e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a,b){return b+1}),c.xAxis().ticks(b.xTicks),c.x(b.getYScale(e)),(null!=(i=e.ordinals)?i.length:void 0)>0&&c.xUnits(b.getXUnits(e))},b.columnChartPostSetup=function(c){var d,e,f,g,h,i;for(e=b.findById(c.anchorName()),e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a,b){return b+1}),c.xAxis().ticks(b.xTicks),c.x(b.getXScale(e)),(null!=(i=e.ordinals)?i.length:void 0)>0&&c.xUnits(b.getXUnits(e))},b.pieChartPostSetup=function(a){var c;c=b.findById(a.anchorName()),c.entry=crossfilter(c.values),c.dimension=c.entry.dimension(function(a){var b;return"date"===c.patterns[c.xLabel].valuePattern?d.humanDate(a.x):b=null!=a.x&&(a.x.length>0||"date"===c.patterns[c.xLabel].valuePattern)?a.x:"N/A"}),c.groupSum=0,c.group=c.dimension.group().reduceSum(function(a){var b;return b=Math.abs(parseFloat(a.y)),c.groupSum+=b,b}),a.dimension(c.dimension),a.group(c.group),a.colorAccessor(function(a,b){return b+1}),a.renderLabel(!1)},b.bubbleChartPostSetup=function(c){var d,e,f,g,h,i,j,k,l,m,n;for(e=b.findById(c.anchorName()),h=null,f=null,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){var b;return b=Math.abs(parseInt(a.z)),(null==h||h>b)&&(h=0===b?1:b),(null==f||b>=f)&&(f=0===b?1:b),""+a.x+"|"+a.y+"|"+a.z}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],n=e.group.all(),l=0,m=n.length;m>l;l++)d=n[l],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key.split("|")[0]);c.keyAccessor(function(a){return a.key.split("|")[0]}),c.valueAccessor(function(a){return a.key.split("|")[1]}),c.radiusValueAccessor(function(a){var b;return b=Math.abs(parseInt(a.key.split("|")[2])),b>=h?b:h}),c.x(function(){switch(e.patterns[e.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.width]);case"date":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[0]})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[0])})).range([0,b.width])}}()),c.y(function(){switch(e.patterns[e.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.height]);case"date":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[1]})).range([0,b.height]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[1])})).range([0,b.height])}}()),j=d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return Math.abs(parseInt(a.key.split("|")[2]))})),c.r(j),c.xAxis().ticks(b.xTicks),c.title(function(a){var b,c,d;return b=a.key.split("|")[0],c=a.key.split("|")[1],d=a.key.split("|")[2],""+e.xLabel+": "+b+"\n"+e.yLabel+": "+c+"\n"+e.zLabel+": "+d}),i=Math.log(h),g=Math.log(f),k=Math.abs(Math.log((g-i)/(f-h))),c.maxBubbleRelativeSize(k/100)},b.resetAll=function(){return dc.filterAll(),dc.redrawAll()}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("OverviewCorrelatedCtrl",["$scope","$routeParams","Overview","PatternMatcher",function(b,c,d){b.allowed=["line","bar","row","column","bubble","scatter","stacked"],b.params=c,b.count=3,b.loading={correlated:!1},b.offset={correlated:0},b.limit={correlated:!1},b.max={correlated:0},b.chartsCorrelated=[],b.xTicks=6,b.width=350,b.height=200,b.margin={top:10,right:10,bottom:30,left:70},b.findById=function(a){var c;return c=_.where(b.chartsCorrelated,{id:a}),null!=(null!=c?c[0]:void 0)?c[0]:null},b.isPlotAllowed=function(c){return a.call(b.allowed,c)>=0?!0:!1},b.getCorrelatedCharts=function(){b.getCorrelated(d.charts("correlated"))},b.hasCorrelatedCharts=function(){return Object.keys(b.chartsCorrelated).length},b.getCorrelated=function(a){var c;b.loading.correlated=!0,null==a||0===a?(a=b.max.correlated-b.offset.correlated,a=b.max.correlated&&a<b.count?a:b.count):c=!0,c=c||b.max.correlated?!1:!0,d.correlated(b.params.id,b.offset.correlated,a,!1).success(function(c){var e,f,g,h;if(b.loading.correlated=!1,null!=c&&null!=c.charts&&c.charts.length>0){b.max.correlated=c.count,h=c.charts;for(g in h)e=h[g],b.isPlotAllowed(e.type)&&(f=new CorrelatedChart(e.type),f.error||(g=parseInt(g),f.info={key:g,id:"correlated-"+b.params.id+"-"+(e.key+b.offset.correlated)+"-"+e.type,url:"charts/correlated/"+b.params.id+"/"+e.correlationid+"/"+e.type+"/"+e.table1.xLabel+"/"+e.table1.yLabel},"bubble"===e.type&&(f.info.url+="/"+e.table1.zLabel),[1,2].forEach(function(a){var b,c,d;return d=f.translateData(e["table"+a].values,e.type),b=function(){var a;return a=d3.min(d,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(d,function(a){return parseFloat(a.y)})]}(),c="column"===e.type||"bar"===e.type?"bar":"area",f.data.push({key:e["table"+a].title,type:c,yAxis:a,values:d}),f.options.chart["yDomain"+a]=b,f.options.chart["yAxis"+a].tickValues=[0],f.options.chart.xAxis.tickValues=[]}),f.setAxisTypes("none","none","none"),f.setSize(null,200),f.setMargin(25,25,25,25),f.setLegend(!1),f.setTooltips(!1),b.chartsCorrelated.push(f)));console.log(b.chartsCorrelated),b.offset.correlated+=a,b.offset.correlated>=b.max.correlated&&(b.limit.correlated=!0),d.charts("correlated",b.offset.correlated)}}).error(function(a,c){b.loading.correlated=!1,console.log("Overview::getCorrelated::Error:",c)})},b.resetAll=function(){return dc.filterAll(),dc.redrawAll()}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("ChartsRelatedCtrl",["$scope","$location","$timeout","$routeParams","Overview","PatternMatcher","Charts","Tracker",function(b,c,d,e,f,g,h,i){b.params=e,b.mode="related",b.width=570,b.height=9*b.width/16,b.margin={top:50,right:10,bottom:50,left:100},b.marginAlt={top:0,right:10,bottom:50,left:110},b.xTicks=8,b.creditMsg=null,b.chartRendered=null,b.chart={title:"",description:"N/A",data:null,values:[]},b.xScale=null,b.yDomain=null,b.userObservations=[],b.userObservationsMessage=[],b.observation={x:null,y:null,message:""},b.info={discoveredId:null,credited:null,discredited:null,patternId:null,discoverer:"",discoverDate:"",creditors:[],source:{prim:"",seco:""},strength:""},b.init=function(){b.initChart()},b.initChart=function(){h.related(b.params.id,b.params.key,b.params.type,b.params.x,b.params.y,b.params.z).success(function(a){var c;return null!=a&&a.chartdata&&(b.chart=a.chartdata,null!=a.desc&&a.desc.length>0&&(c=a.desc.replace(/(h1>|h2>|h3>)/gi,"h4>"),c=c.replace(/\n/gi,""),b.chart.description=c),b.reduceData()),null!=a&&(b.info.patternId=a.patternid||"",b.info.discoveredId=a.discoveredid||"",b.info.discoverer=a.discoveredby||"",b.info.discoverDate=a.discoverydate?f.humanDate(new Date(a.discoverydate)):"",b.info.creditors=a.creditedby||"",b.info.source={prim:a.source1||"",seco:a.source2||""},b.info.strength=a.statstrength),console.log("Chart",b.chart),b.initObservations(),i.visited(b.params.id,b.params.key,b.params.type,b.params.x,b.params.y,b.params.z)}).error(function(a,c){return b.handleError(a,c),console.log("Charts::init::Error:",c)})},b.initObservations=function(a){var c,d;c=""+b.params.id+"/"+b.params.key+"/"+b.params.type+"/"+b.params.x+"/"+b.params.y,(null!=(d=b.params.z)?d.length:void 0)>0&&(c+="/"+b.params.z),h.getObservations(b.info.discoveredId).then(function(c){var d,e;return b.userObservations.splice(0,b.userObservations.length),null!=(e=c.data)&&"function"==typeof e.forEach&&e.forEach(function(a){var c,d,e,g;return c=a.x,g=a.y,"date"===b.chart.patterns[b.chart.xLabel].valuePattern&&(c instanceof Date||"string"!=typeof c||(d=new Date(c),"Invalid Date"!==d.toString()&&(c=d)),c=f.humanDate(c)),e=""+c.replace(/\W/g,"")+"-"+g.replace(/\W/g,""),b.userObservationsMessage[e]=a.comment,b.userObservations.push({xy:e,oid:a.observation_id,user:a.user,creditCount:parseInt(a.credits-a.discredits)||0,message:a.comment,date:f.humanDate(new Date(a.created)),coor:{x:a.x,y:a.y}})}),null!=a&&a?(b.redrawObservationIcons(),d=d3.select("g.stack-list > .observations.new"),b.renderObservationIcons(b.xScale,b.yDomain,b.chart,d)):void 0},b.handleError)},b.reduceData=function(){var a,c,d,e,f;if(b.chart.data=b.chart.values,b.chart.patterns={},b.chart.patterns[b.chart.xLabel]={valuePattern:g.getPattern(b.chart.values[0].x),keyPattern:g.getKeyPattern(b.chart.values[0].x)},"date"===b.chart.patterns[b.chart.xLabel].valuePattern)for(f=b.chart.values,a=d=0,e=f.length;e>d;a=++d)c=f[a],b.chart.values[a].x=new Date(c.x);return null!=b.chart.yLabel?b.chart.patterns[b.chart.yLabel]={valuePattern:g.getPattern(b.chart.values[0].y),keyPattern:g.getKeyPattern(b.chart.values[0].y)}:void 0},b.getXScale=function(a){var c;return c=function(){switch(a.patterns[a.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([0,b.width]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.key})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.key)})).range([0,b.width])}}()},b.getYScale=function(a){var c;return c=function(){switch(a.patterns[a.yLabel].valuePattern){case"label":return d3.scale.ordinal().domain(a.ordinals).rangeBands([b.height,0]);case"date":return d3.time.scale().domain(d3.extent(a.group.all(),function(a){return a.value})).range([b.height,0]);default:return d3.scale.linear().domain(d3.extent(a.group.all(),function(a){return parseInt(a.value)})).range([b.height,0])}}()},b.nearestNeighbour=function(a,b,c){var d,e,f,g;return a=parseInt(a),e=b[a][c],f=null!=b[a+1]?b[a+1][c]:null,g=null!=b[a-1]?b[a-1][c]:null,d=e,e===f?d=f:e===g?d=g:null==f||Math.abs(e-f)>=Math.abs(e-g)?d=g:(null==g||Math.abs(e-f)<=Math.abs(e-g))&&(d=f),d},b.drawObservationIcon=function(a,c,d,e,g){var h,i,j,k,l,m,n;return"date"===c.patterns[c.xLabel].valuePattern&&(d instanceof Date||"string"!=typeof d||(l=new Date(d),"Invalid Date"!==l.toString()&&(d=l)),d=f.humanDate(d)),m=""+d.replace(/\W/g,"")+"-"+e.replace(/\W/g,""),k="clipImage-"+m,i=a.append("clipPath").attr("id",k).append("circle").attr("r",10).attr("cx",g[0]).attr("cy",g[1]),j=(null!=(n=b.userObservationsMessage[m])?n.length:void 0)>0?b.userObservationsMessage[m]:"",j=j.length>10?""+j.substr(0,10)+"...":j,h=a.append("image").attr("id","observationIcon-"+m).attr("xlink:href","images/observation.png").attr("style","stroke: none; fill: none; fill-opacity: 0.0; stroke-opacity: 0.0").attr("height","20px").attr("width","20px").attr("x",g[0]-10).attr("y",g[1]-10).attr("clip-path","url(#"+k+")").attr("data-placement","top").attr("data-html",!0).tooltip(""+b.chart.xLabel+": "+d+"<br/>"+b.chart.yLabel+": "+e+"<br/>comment: "+j)},b.redrawObservationIcons=function(){return d3.selectAll("g.observations > *").remove()},b.renderObservationIcons=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;for(p=b.userObservations,q=[],n=0,o=p.length;o>n;n++)if(h=p[n],0!==h.coor.x&&"0"!==h.coor.x||0!==h.coor.y&&"0"!==h.coor.y){k=h.coor.x,k instanceof Date||"string"!=typeof k||(l=new Date(k),"Invalid Date"!==l.toString()&&(k=l));for(g in c){if(j=c[g],j.y===h.coor.y){f=g;break}parseInt(j.y)>parseInt(h.coor.y)&&(f=g)}null!=c&&null!=c[f]&&null!=c[f].y&&(m=c[f].y,i=[a(k),c[f].cy],q.push(b.drawObservationIcon(e,d,k,m,i)))}return q},b.lineChartPostSetup=function(c){var d,e,g,h,i,j,k,l,m;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group,e.title),e.ordinals=[],m=e.group.all(),k=0,l=m.length;l>k;k++)d=m[k],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.keyAccessor(function(a){return a.key}),c.valueAccessor(function(a){return a.value}),c.title(function(a){var c;return c=a.key,"date"===b.chart.patterns[b.chart.xLabel].valuePattern&&(c=f.humanDate(a.key)),""+b.chart.xLabel+": "+c+"\n"+b.chart.yLabel+": "+a.value}),i=b.getXScale(e),c.x(i),j=b.getYScale(e),e.ordinals.length>0&&c.xUnits(function(){switch(e.patterns[e.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.yAxisLabel(e.yLabel),g=null,h=null,c.renderlet(function(a){var c,d,f,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(r=d3.select("svg"),p=d3.select("g.stack-list").node(),c=p.getBBox(),q=d3.select("g.stack-list"),null==g&&(g=q.append("g").attr("class","stack _"+(q.length+0)+" observations existing")),null==h&&(h=q.append("g").attr("class","stack _"+(q.length+1)+" observations new")),b.redrawObservationIcons(),f=a.svg().selectAll("circle.dot"),d=a.svg().selectAll("circle.dot > title"),s=[],x=f[0],o=t=0,v=x.length;v>t;o=++t)k=x[o],s[o]={cy:k.cy.animVal.value,y:null};for(y=d[0],o=u=0,w=y.length;w>u;o=++u)l=y[o],n=l.innerHTML.split("\n"),s[o].y=n[1].split(": ")[1];return s.sort(function(a,b){return a.cy-b.cy}),m=null,f.on("click",function(a){return m=a}),r.on("click",function(){var a,d,f,g,k,l,n,q,r,t,u;if(g=d3.mouse(p),!(g[0]<0||g[1]<0||g[0]>c.width||g[1]>c.height)){for(null!=m?(n=m.x,q=m.y,m=null):(n=i.invert(g[0]),q=j.invert(g[1])),u=e.group.all(),f=r=0,t=u.length;t>r;f=++r)if(l=u[f],"date"===e.patterns[e.xLabel].valuePattern){if(n.getTime()===l.key.getTime()){o=f;break}n.getTime()>l.key.getTime()&&(o=f)}else{if(n===l.key){o=f;break}n>l.key&&(o=f)}n=e.group.all()[o].key,b.nearestNeighbour(o,e.group.all(),"key");for(d in s){if(k=s[d],k.cy===g[1]){a=d;break}k.cy<=g[1]&&(a=d)}return q=s[a].y,b.nearestNeighbour(a,s,"y"),b.openAddObservationModal(n,q),b.drawObservationIcon(h,e,n,q,g)}}),b.xScale=i,b.yDomain=s,b.renderObservationIcons(i,s,e,h)}),b.chartRendered=c},b.rangeChartPostSetup=function(c){var d,e,f,g,h;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.x(b.getXScale(e)),e.ordinals.length>0&&c.xUnits(function(){switch(e.patterns[e.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}())},b.rowChartPostSetup=function(c){var d,e,f,g,h;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a,b){return(b+1)%20}),c.xAxis().ticks(b.xTicks),c.x(b.getYScale(e)),"undefined"!=typeof ordinals&&null!==ordinals&&ordinals.length>0&&c.xUnits(function(){switch(e.patterns[e.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.xAxisLabel(e.xLabel),c.yAxisLabel(e.yLabel)},b.columnChartPostSetup=function(c){var d,e,f,g,h;for(e=b.chart,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){return a.x}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],h=e.group.all(),f=0,g=h.length;g>f;f++)d=h[f],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key);c.colorAccessor(function(a,b){return b+1}),c.yAxis().ticks(b.xTicks),c.x(b.getXScale(e)),"undefined"!=typeof ordinals&&null!==ordinals&&ordinals.length>0&&c.xUnits(function(){switch(e.patterns[e.xLabel].valuePattern){case"date":return d3.time.years;case"intNumber":return dc.units.integers;case"label":case"text":return dc.units.ordinal;default:return dc.units.ordinal}}()),c.xAxisLabel(e.xLabel),c.yAxisLabel(e.yLabel)},b.pieChartPostSetup=function(a){var c;c=b.chart,c.entry=crossfilter(c.values),c.dimension=c.entry.dimension(function(a){var b;return"date"===c.patterns[c.xLabel].valuePattern?f.humanDate(a.x):b=null!=a.x&&(a.x.length>0||"date"===c.patterns[c.xLabel].valuePattern)?a.x:"N/A"}),c.groupSum=0,c.group=c.dimension.group().reduceSum(function(a){var b;return b=Math.abs(parseFloat(a.y)),c.groupSum+=b,b}),a.dimension(c.dimension),a.group(c.group),a.colorAccessor(function(a,b){return b+1}),a.renderLabel(!1),a.renderTitle(!0),a.title(function(a){var b;return b=a.value/c.groupSum*100,""+a.key+": "+a.value+" ["+Math.floor(b)+"%]"}),a.legend(dc.legend().x(0).y(350)),a.minAngleForLabel(0),a.innerRadius(75)},b.bubbleChartPostSetup=function(c){var d,e,f,g,h,i,j,k,l,m,n;for(e=b.chart,h=null,f=null,e.entry=crossfilter(e.values),e.dimension=e.entry.dimension(function(a){var b;return b=Math.abs(parseInt(a.z)),(null==h||h>b)&&(h=0===b?1:b),(null==f||b>=f)&&(f=0===b?1:b),""+a.x+"|"+a.y+"|"+a.z}),e.group=e.dimension.group().reduceSum(function(a){return a.y}),c.dimension(e.dimension),c.group(e.group),e.ordinals=[],n=e.group.all(),l=0,m=n.length;m>l;l++)d=n[l],a.call(e.ordinals,d)<0&&e.ordinals.push(d.key.split("|")[0]);c.keyAccessor(function(a){return a.key.split("|")[0]}),c.valueAccessor(function(a){return a.key.split("|")[1]}),c.radiusValueAccessor(function(a){var b;return b=Math.abs(a.key.split("|")[2]),b>=h?b:h}),c.x(function(){switch(e.patterns[e.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.width]);case"date":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[0]})).range([0,b.width]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[0])})).range([0,b.width])}}()),c.y(function(){switch(e.patterns[e.xLabel].valuePattern){case"label":return d3.scale.ordinal().domain(e.ordinals).rangeBands([0,b.height]);case"date":return d3.time.scale().domain(d3.extent(e.group.all(),function(a){return a.key.split("|")[1]})).range([0,b.height]);default:return d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return parseInt(a.key.split("|")[1])})).range([0,b.height])}}()),j=d3.scale.linear().domain(d3.extent(e.group.all(),function(a){return Math.abs(parseInt(a.key.split("|")[2]))})),c.r(j),c.xAxis().ticks(b.xTicks),c.label(function(a){var b;return b=a.key.split("|")[0]}),c.title(function(a){var b,c,d;return b=a.key.split("|")[0],c=a.key.split("|")[1],d=a.key.split("|")[2],""+e.xLabel+": "+b+"\n"+e.yLabel+": "+c+"\n"+e.zLabel+": "+d}),i=Math.log(h),g=Math.log(f),k=Math.abs(Math.log((g-i)/(f-h))),c.maxBubbleRelativeSize(k/100),c.zoomOutRestrict(!0),c.mouseZoomable(!0),c.xAxisLabel(e.xLabel),c.yAxisLabel(e.yLabel)},b.creditChart=function(a){var c,d;return c=""+b.params.id+"/"+b.params.key+"/"+b.params.type+"/"+b.params.x+"/"+b.params.y,(null!=(d=b.params.z)?d.length:void 0)>0&&(c+="/"+b.params.z),h.creditChart("rid",c,a).then(function(){return b.showCreditMessage(a),a?b.info.credited=!0:b.info.discredited=!0},b.handleError)},b.saveObservation=function(){h.createObservation(b.info.discoveredId,b.observation.x,b.observation.y,b.observation.message).then(function(){return b.observation.message="",b.addObservation(b.observation.x,b.observation.y,b.observation.message),$("#comment-modal").modal("hide")},b.handleError)},b.clearObservation=function(){var a,c,d,e;return b.observation.message="",a=b.observation.x,e=b.observation.y,0!==a&&"0"!==a||0!==e&&"0"!==e?(a instanceof Date||"string"!=typeof a?a instanceof Date&&(a=f.humanDate(a)):(c=new Date(a),"Invalid Date"!==c.toString()&&(a=f.humanDate(c))),d=""+a.replace(/\W/g,"")+"-"+e.replace(/\W/g,""),d3.select("#clipImage-"+d).remove(),d3.select("#observationIcon-"+d).remove(),void $("#comment-modal").modal("hide")):void $("#comment-modal").modal("hide")},b.creditObservation=function(a,c){return null!=a.oid?h.creditObservation(a.oid,c).success(function(){var b;return a.creditCount+=null!=(b=c)?b:{1:-1}}).error(b.handleError):void 0},b.openAddObservationModal=function(a,c){b.observation.x=a||0,b.observation.y=c||0,b.observation.message="",$("#comment-modal").modal("show")},b.addObservation=function(){return b.initObservations(!0)},b.resetObservations=function(){return d3.selectAll("g.observations.new > *").remove()},b.resetAll=function(){return dc.filterAll(),dc.redrawAll(),b.resetObservations()},b.showCreditMessage=function(a){b.creditMsg=a,d(function(){return b.creditMsg=null},3e3)},b.handleError=function(a){return b.error={message:function(){switch(!1){case!(a&&a.message):return a.message;case!(a&&a.data&&a.data.message):return a.data.message;case!(a&&a.data):return a.data;case!a:return a;default:return""}}()}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("ChartsCorrelatedCtrl",["$scope","$location","$routeParams","Overview","PatternMatcher","Charts","Tracker",function(a,b,c,d,e,f,g){a.params=c,a.mode="correlated",a.width=570,a.height=9*a.width/16,a.chart=new CorrelatedChart,a.userObservations=[],a.userObservationsMessage=[],a.observation={x:null,y:null,message:""},a.info={discoveredId:null,credited:null,discredited:null,patternId:null,discoverer:"",discoverDate:"",creditors:[],source:{prim:"",seco:""},strength:""},a.init=function(){a.initChart()},a.initChart=function(){f.correlated(a.params.correlationid).success(function(b){return null!=b&&b.chartdata&&(a.chart.generate(b.chartdata.type),a.chart.error||([1,2].forEach(function(c){var d,e,f;return f=a.chart.translateData(b.chartdata["table"+c].values,b.chartdata.type),d=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===b.chartdata.type||"bar"===b.chartdata.type?"bar":"area",a.chart.data.push({key:b.chartdata["table"+c].title,type:e,yAxis:c,values:f}),a.chart.options.chart["yDomain"+c]=d,a.chart.options.chart["yAxis"+c].tickValues=function(){return[1,2,3,4,5,6,7,8].map(function(a){return d[0]+(d[1]-d[0])*(1/8)*a})}()}),a.chart.setAxisTypes(b.chartdata.table1.xLabel,b.chartdata.table1.yLabel,b.chartdata.table2.yLabel))),null!=b&&(a.info.patternId=b.patternid||"",a.info.discoveredId=b.discoveredid||"",a.info.discoverer=b.discoveredby||"",a.info.discoverDate=b.discoverydate?d.humanDate(new Date(b.discoverydate)):"",a.info.creditors=b.creditedby||"",a.info.source={prim:b.source1||"",seco:b.source2||""},a.info.strength=b.statstrength),a.initObservations(),console.log("Chart",a.chart),g.visited(a.params.id,a.params.key,a.params.type,a.params.x,a.params.y,a.params.z)}).error(function(a,b){return console.log("Charts::init::Error:",b)})},a.initObservations=function(){var b;b=""+a.params.correlationid,f.getObservations(a.info.discoveredId).then(function(b){var c;return a.userObservations.splice(0,a.userObservations.length),null!=(c=b.data)&&"function"==typeof c.forEach?c.forEach(function(b){var c,e,f,g;return c=b.x,g=b.y,"date"===a.chart.patterns[a.chart.table1.xLabel].valuePattern&&(c instanceof Date||"string"!=typeof c||(e=new Date(c),"Invalid Date"!==e.toString()&&(c=e)),c=d.humanDate(c)),f=""+c.replace(/\W/g,"")+"-"+g.replace(/\W/g,""),a.userObservationsMessage[f]=b.comment,a.userObservations.push({xy:f,oid:b.observation_id,user:b.user,creditCount:parseInt(b.credits-b.discredits)||0,message:b.comment,date:d.humanDate(new Date(b.created)),coor:{x:b.x,y:b.y}})}):void 0},a.handleError)},a.creditChart=function(b){var c,d;return c=""+a.params.id+"/"+a.params.key+"/"+a.params.type+"/"+a.params.x+"/"+a.params.y,(null!=(d=a.params.z)?d.length:void 0)>0&&(c+="/"+a.params.z),f.creditChart("rid",c,b).then(function(){return a.showCreditMessage(b),b?a.info.credited=!0:a.info.discredited=!0},a.handleError)},a.saveObservation=function(){f.createObservation(a.info.discoveredId,a.observation.x,a.observation.y,a.observation.message).then(function(){return a.observation.message="",a.addObservation(a.observation.x,a.observation.y,a.observation.message),$("#comment-modal").modal("hide")},a.handleError)},a.clearObservation=function(){var b,c,e,f;return a.observation.message="",b=a.observation.x,f=a.observation.y,0!==b&&"0"!==b||0!==f&&"0"!==f?(b instanceof Date||"string"!=typeof b?b instanceof Date&&(b=d.humanDate(b)):(c=new Date(b),"Invalid Date"!==c.toString()&&(b=d.humanDate(c))),e=""+b.replace(/\W/g,"")+"-"+f.replace(/\W/g,""),d3.select("#clipImage-"+e).remove(),d3.select("#observationIcon-"+e).remove(),void $("#comment-modal").modal("hide")):void $("#comment-modal").modal("hide")},a.creditObservation=function(b,c){return null!=b.oid?f.creditObservation(b.oid,c).success(function(){var a;return b.creditCount+=null!=(a=c)?a:{1:-1}}).error(a.handleError):void 0},a.openAddObservationModal=function(b,c){a.observation.x=b||0,a.observation.y=c||0,a.observation.message="",$("#comment-modal").modal("show")},a.addObservation=function(b,c,d,e){return a.observations.push({x:b,y:c,space:d,comment:null!=e&&e.length>0?e:"",timestamp:Date.now()}),a.$apply()},a.resetObservations=function(){return a.observations=[]},a.resetAll=function(){return dc.filterAll(),dc.redrawAll(),a.resetObservations()}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("UserCtrl",["$scope","$location","$routeParams","User","Auth","config",function(a,b,c,d,e,f){a.params=c,a.user={token:a.params.token,username:null,password:null,password_confirm:null,message:null},a.forgotPassword={valid:!1,sent:!1},a.resetPassword={valid:!1,saved:!1},a.currentTab="details",a.login=function(b){null!=b.username&&null!=b.password&&d.logIn(b.username,b.password).success(function(b){a.processLogin(b)}).error(function(b){a.user.message=b,console.log("User::Login::Error:",b)})},a.processLogin=function(a){e.set(f.userName,a.user),e.set(f.sessionName,a.session),b.path("/home")},a.logout=function(){var c;c=e.get(f.sessionName),c!==!1&&d.logOut(c).success(function(){e.remove(f.sessionName),e.remove(f.userName),b.path("/")}).error(function(b){a.user.message=b,console.log("User::Logout::Error:",b)}),b.path("/user/login")},a.register=function(b){null!=b.username&&null!=b.password&&d.register(b.username,b.password).success(function(b){a.processLogin(b)}).error(function(b){a.user.message=b,console.log("User::Register::Error:",b)})},a.forgotPassword=function(b){a.closeAlert(),null!=b.username&&d.check(b.username).success(function(){return a.forgotPassword.valid=!0,d.forgotPassword(b.username).success(function(b){a.forgotPassword.sent=!0,a.user.token=b.token}).error(function(b,c){a.forgotPassword.valid=!1,a.user.message=b,console.log("User::ForgotPassword::token::Error:",b,c)})}).error(function(b,c){a.user.message=b,console.log("User::ForgotPassword::check::Error:",b,c)})},a.resetPasswordCheck=function(b){return a.closeAlert(),null!=b.token&&null!=b.username?d.token(b.token,b.username).success(function(){a.resetPassword.valid=!0}).error(function(b,c){a.user.message=b,console.log("User::ResetPassword::check::Error:",b,c)}):void 0},a.resetPassword=function(b){return a.closeAlert(),null!=b.token&&null!=b.username&&null!=b.password?d.token(b.token,b.username,b.password).success(function(){a.resetPassword.saved=!0}).error(function(b,c){a.user.message=b,console.log("User::ResetPassword::save::Error:",b,c)}):void 0},a.hasError=function(){var b;return(null!=(b=a.user.message)?b.length:void 0)?!0:!1},a.closeAlert=function(){return a.user.message=null},a.changeTab=function(b){return a.currentTab=b}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("ProfileCtrl",["$scope","$location","$routeParams","Profile","Auth","config",function(a,b,c,d){var e,f,g,h;a.params=c,a.currentTab=(null!=(g=a.params)&&null!=(h=g.tab)?h.length:void 0)>0?a.params.tab:"profile",a.error={message:null},a.current={email:"",username:""},a.saved={email:"",username:"",success:!1},a.creditDiscoveries=[],a.discoveries=[],a.observations=[],a.inits={profile:function(){return d.getInfo().success(function(b){return a.current.email=b.email,a.current.username=b.username,a.saved.email=b.email,a.saved.username=b.username}).error(function(b,c){return a.handleError(b,c)})},creditdiscoveries:function(){return d.getCreditDiscoveries().success(function(b){b instanceof Array&&(a.creditDiscoveries=b)}).error(function(b,c){return a.handleError(b,c)})},discoveries:function(){return d.getDiscoveries().success(function(b){b instanceof Array&&(a.discoveries=b)}).error(function(b,c){return a.handleError(b,c)})},observations:function(){return d.getObservations().success(function(b){b instanceof Array&&(a.observations=b)}).error(function(b,c){return a.handleError(b,c)})}},"function"==typeof(e=a.inits)[f=a.currentTab]&&e[f](),a.changeTab=function(a){return b.path("/user/"+a)},a.submitDetails=function(){return d.setInfo(a.current.email,a.current.username).then(function(){return a.saved.email=a.current.email,a.saved.username=a.current.username,a.saved.success=!0
})},a.clearDetails=function(){return a.current.email=a.saved.email,a.current.username=a.saved.username},a.closeAlert=function(){return a.saved.success=!1},a.hasError=function(){var b;return(null!=(b=a.error.message)?b.length:void 0)?!0:!1},a.handleError=function(b){return a.error.message=function(){switch(!1){case!(b&&b.message):return b.message;case!(b&&b.data&&b.data.message):return b.data.message;case!(b&&b.data):return b.data;case!b:return b;default:return""}}()}}])}.call(this),function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("dataplayApp").controller("OverviewScreenCtrl",["$scope","$location","$routeParams","OverviewScreen","Auth","config",function(b,c,d,e){b.params=d,b.mapGen=new MapGenerator("#regionMap"),b.margin={top:0,right:0,bottom:0,left:0},b.mainSections={d:{title:"Gov Departments/Bodies",colNameA:"Entities",colNameB:"Last 30 days",error:null,type:"pie",graph:[],items:[]},e:{title:"Political Events",colNameA:"Event",colNameB:"Last 30 days",error:null,type:"pie",graph:[],items:[]},r:{title:"Politically Aware/Active",colNameA:"Location",colNameB:"Last 30 days",error:null,type:"map",graph:[],items:[]}},b.colourMap={},b.sidebarSections=[],b.init=function(){return["d","e","r"].forEach(function(a){return e.get(a).success(function(c){var d,e;return c instanceof Array&&(b.mainSections[a].items=c,e=0,b.mainSections[a].items.forEach(function(c){var d,f,g,h,i;for(f=0,i=c.graph,g=0,h=i.length;h>g;g++)d=i[g],f+=d.y;f>e&&(e=f),c.id=""+a.replace(/\W/g,"").toLowerCase()+"-"+c.term.replace(/\W/g,"").toLowerCase(),b.mainSections[a].graph.push({id:c.id,term:c.term,value:f})}),"map"===b.mainSections[a].type)?(d={},b.mainSections[a].graph.forEach(function(a){var c;return c=a.term.toLowerCase().replace(/_|\-|\'|\s/g,""),b.mapGen.locationDictionary[c]&&(c=b.mapGen.locationDictionary[c]),d[c]=a.value}),b.mapGen.maxvalue=e,c=Object.keys(b.mapGen.boundaryPaths).map(function(a){return{name:a,value:d[a]||0}}),b.mapGen.generate(c),b.mainSections[a].items.forEach(function(a){var c;return c=a.term.toLowerCase().replace(/_|\-|\'|\s/g,""),b.mapGen.locationDictionary[c]&&(c=b.mapGen.locationDictionary[c]),a.corresponds="county-"+c,a.color=b.mapGen.getColor(d[c]||0)})):void 0}).error(b.handleError(a))}),e.get("p").success(function(a){return a instanceof Array?b.sidebarSections=a.map(function(a){return a.url="top_discoverers"===a.id?"user/profile":"search",a.top5=a.top5.filter(function(a){return a.amount>0}),a}):void 0}).error(b.handleError("p"))},b.renderLine=function(b){return function(c){var d,e,f,g,h,i,j,k,l,m;for(g=b.graph,f=crossfilter(g),e=f.dimension(function(a){return a.x}),h=e.group().reduceSum(function(a){return a.y}),i=[],m=h.all(),k=0,l=m.length;l>k;k++)d=m[k],a.call(i,d)<0&&i.push(d.key);c.colorAccessor(function(a){return parseInt(a.y)%i.length}),c.dimension(e),c.group(h),j=d3.scale.linear().domain(d3.extent(h.all(),function(a){return parseInt(a.key)})).range([0,60]),c.x(j),c.keyAccessor(function(a){return a.key}),c.valueAccessor(function(a){return a.value}),c.xAxis().ticks(0).tickFormat(function(){return""}),c.yAxis().ticks(0).tickFormat(function(){return""}),c.xAxisLabel(!1,0),c.yAxisLabel(!1,0)}},b.renderPie=function(a){return function(c){var d,e,f,g,h,i,j;return h=a.graph,g=crossfilter(h),f={},e=g.dimension(function(a){return f[""+a.term+"-"+a.value]=a.id,a.term}),j=0,i=e.group().reduceSum(function(a){return j+=a.value,a.value}),c.dimension(e),c.group(i),d=function(){var b;return b={min:100,max:0},a.graph.forEach(function(a){return a.value>b.max&&(b.max=a.value),a.value<b.min?b.min=a.value:void 0}),b}(),c.colors(function(c){var e;return e=0,a.graph.forEach(function(a){return a.term===c?e=a.value:void 0}),b.mapGen.getColor(e-d.min,d.max-d.min)}),c.renderlet(function(a){var c,d;return d=d3.select("svg"),c=a.svg().selectAll("g.pie-slice"),c.each(function(a){var c,d,e;return d=f[""+a.data.key+"-"+a.data.value],e=d3.select(this),e.attr("id","slice-"+d),c=e.select("path").attr("fill"),b.colourMap[d]=c}),c.on("mouseover",function(a){var b,c,d,e;return c=d3.select(this),d=d3.event.pageX,e=d3.event.pageY,b=(a.data.value/j*100).toFixed(2),d3.select("#pie-tooltip").style("left",""+d+"px").style("top",""+e+"px").attr("class","tooltip fade top in").select(".tooltip-inner").text(""+a.data.key+": "+a.data.value+" ("+b+"%)")}),c.on("mouseout",function(){return d3.select("#pie-tooltip").attr("class","tooltip top hidden")})})}},b.highlightPieSlice=function(a){var b;return b=document.getElementById("slice-"+a),null==b?null:void 0},b.handleError=function(a){return function(c){return b.mainSections[a].error=function(){switch(!1){case!(c&&c.message):return c.message;case!(c&&c.data&&c.data.message):return c.data.message;case!(c&&c.data):return c.data;case!c:return c;default:return""}}()}}}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("LandingCtrl",["$scope","$location","Home","Auth","Overview","PatternMatcher","config",function(a,b,c,d,e,f,g){a.config=g,a.Auth=d,a.username=d.get(g.userName),a.chartsRelated=[],a.relatedChart=new RelatedCharts(a.chartsRelated),d.isAuthenticated()&&b.path("/home"),a.stats={players:null,discoveries:null,datasets:null},a.init=function(){return c.getStats().success(function(b){return b instanceof Array?b.forEach(function(b){return a.stats[b.Label]=a.commarise(b.Value)}):void 0}),c.getTopRated().success(function(b){var c,d,e,g,h,i,j,k,l;if(null!=b&&b.length>0){l=[];for(g in b)if(c=b[g],a.relatedChart.isPlotAllowed(c.type))if(g=parseInt(g),null!=c.relationid){if(e=c.relationid.split("/")[0],c.key=g,c.id="related-"+e+"-"+(c.key+a.relatedChart.offset.related)+"-"+c.type,c.url="charts/related/"+e+"/"+c.key+"/"+c.type+"/"+c.xLabel+"/"+c.yLabel,"bubble"===c.type&&(c.url+="/"+c.zLabel),c.patterns={},c.patterns[c.xLabel]={valuePattern:f.getPattern(c.values[0].x),keyPattern:f.getKeyPattern(c.values[0].x)},"date"===c.patterns[c.xLabel].valuePattern)for(k=c.values,g=i=0,j=k.length;j>i;g=++i)h=k[g],c.values[g].x=new Date(h.x);null!=c.yLabel&&(c.patterns[c.yLabel]={valuePattern:f.getPattern(c.values[0].y),keyPattern:f.getKeyPattern(c.values[0].y)}),l.push(f.includePattern(c.patterns[c.xLabel].valuePattern,c.patterns[c.xLabel].keyPattern)?a.chartsRelated.push(c):void 0)}else null!=c.correlationid?(d=new CorrelatedChart(c.type),d.error?l.push(void 0):(d.info={key:g,id:"corr",url:"corr",title:[c.table1.title,c.table2.title]},"bubble"===c.type&&(d.info.url+="/"+c.table1.zLabel),[1,2].forEach(function(a){var b,e,f;return f=d.translateData(c["table"+a].values,c.type),b=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===c.type||"bar"===c.type?"bar":"area",d.data.push({key:c["table"+a].title,type:e,yAxis:a,values:f}),d.options.chart["yDomain"+a]=b,d.options.chart["yAxis"+a].tickValues=[0],d.options.chart.xAxis.tickValues=[]}),d.setAxisTypes("none","none","none"),d.setSize(null,200),d.setMargin(25,25,25,25),d.setLegend(!1),d.setTooltips(!1),l.push(a.chartsRelated.push(d)))):l.push(void 0);return l}})},a.commarise=function(a){return Number(a).toLocaleString()},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this),function(){"use strict";angular.module("dataplayApp").controller("HomeCtrl",["$scope","$location","Home","Auth","Overview","PatternMatcher","config",function(a,b,c,d,e,f,g){a.config=g,a.searchquery="",a.creditPatterns=null,a.myActivity=null,a.recentObservations=null,a.dataExperts=null,a.chartsRelated=[],a.relatedChart=new RelatedCharts(a.chartsRelated),a.init=function(){return c.getAwaitingCredit().success(function(b){var c,d,e,g,h,i,j,k,l;if(null!=b&&null!=b.charts&&b.charts.length>0){k=b.charts;for(g in k)if(c=k[g],a.relatedChart.isPlotAllowed(c.type))if(g=parseInt(g),null!=c.relationid){if(e=c.relationid.split("/")[0],c.key=g,c.id="related-"+e+"-"+(c.key+a.relatedChart.offset.related)+"-"+c.type,c.url="charts/related/"+e+"/"+c.key+"/"+c.type+"/"+c.xLabel+"/"+c.yLabel,"bubble"===c.type&&(c.url+="/"+c.zLabel),c.patterns={},c.patterns[c.xLabel]={valuePattern:f.getPattern(c.values[0].x),keyPattern:f.getKeyPattern(c.values[0].x)},"date"===c.patterns[c.xLabel].valuePattern)for(l=c.values,g=i=0,j=l.length;j>i;g=++i)h=l[g],c.values[g].x=new Date(h.x);null!=c.yLabel&&(c.patterns[c.yLabel]={valuePattern:f.getPattern(c.values[0].y),keyPattern:f.getKeyPattern(c.values[0].y)}),f.includePattern(c.patterns[c.xLabel].valuePattern,c.patterns[c.xLabel].keyPattern)&&a.chartsRelated.push(c)}else null!=c.correlationid&&(d=new CorrelatedChart(c.type),d.error||(d.info={key:g,id:"corr",url:"corr",title:[c.table1.title,c.table2.title]},"bubble"===c.type&&(d.info.url+="/"+c.table1.zLabel),[1,2].forEach(function(a){var b,e,f;return f=d.translateData(c["table"+a].values,c.type),b=function(){var a;return a=d3.min(f,function(a){return parseFloat(a.y)}),[a>0?0:a,d3.max(f,function(a){return parseFloat(a.y)})]}(),e="column"===c.type||"bar"===c.type?"bar":"area",d.data.push({key:c["table"+a].title,type:e,yAxis:a,values:f}),d.options.chart["yDomain"+a]=b,d.options.chart["yAxis"+a].tickValues=[0],d.options.chart.xAxis.tickValues=[]}),d.setAxisTypes("none","none","none"),d.setSize(null,200),d.setMargin(25,25,25,25),d.setLegend(!1),d.setTooltips(!1),a.chartsRelated.push(d)));return console.log(a.chartsRelated)}return a.creditPatterns=[]}).error(function(){return a.creditPatterns=[]}),c.getActivityStream().success(function(b){return a.myActivity=b instanceof Array?b.map(function(a){return{date:e.humanDate(new Date(a.time)),pretext:a.activitystring,linktext:a.patternid,url:a.linkstring}}):[]}).error(function(){return a.myActivity=[]}),c.getRecentObservations().success(function(b){return a.recentObservations=b instanceof Array?b.map(function(a){return{user:{name:a.username,avatar:"http://www.gravatar.com/avatar/"+a.MD5email+"?d=identicon"},text:a.comment,url:a.linkstring}}):[]}).error(function(){return a.recentObservations=[]}),c.getDataExperts().success(function(b){var c;return b instanceof Array?(c=["gold","silver","bronze"],a.dataExperts=b.map(function(a,b){var d;return d={rank:b+1,name:a.username,avatar:"http://www.gravatar.com/avatar/"+a.MD5email+"?d=identicon",score:a.reputation},d.rank<=3&&(d.rankclass=c[d.rank-1]),d})):a.dataExperts=[]}).error(function(){return a.dataExperts=[]})},a.search=function(){return b.path("/search/"+a.searchquery)},a.width=a.relatedChart.width,a.height=a.relatedChart.height,a.margin=a.relatedChart.margin,a.hasRelatedCharts=a.relatedChart.hasRelatedCharts,a.lineChartPostSetup=a.relatedChart.lineChartPostSetup,a.rowChartPostSetup=a.relatedChart.rowChartPostSetup,a.columnChartPostSetup=a.relatedChart.columnChartPostSetup,a.pieChartPostSetup=a.relatedChart.pieChartPostSetup,a.bubbleChartPostSetup=a.relatedChart.bubbleChartPostSetup}])}.call(this);